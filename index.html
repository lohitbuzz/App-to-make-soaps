<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lohit SOAP App v1.5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- MAIN DESKTOP / IPAD APP -->
  <div id="app-main" class="app-root hidden">
    <header class="top-bar">
      <div class="top-left">
        <div class="app-title">Lohit SOAP App <span class="app-version">v1.5</span></div>
        <div class="case-id-display">Case: <span id="caseIdLabel"></span></div>
      </div>
      <div class="top-right">
        <div class="toggle-group">
          <label class="toggle-label">Mode</label>
          <div class="pill-toggle" id="modeToggle">
            <button data-mode="appointment" class="pill-option active">Appointment</button>
            <button data-mode="surgery" class="pill-option">Surgery</button>
          </div>
        </div>

        <div class="toggle-group">
          <label class="toggle-label">Profile</label>
          <div class="pill-toggle" id="profileToggle">
            <button data-profile="client" class="pill-option active">Client</button>
            <button data-profile="rescue" class="pill-option">Rescue</button>
          </div>
        </div>

        <div class="toggle-group">
          <label class="toggle-label">Accuracy</label>
          <div class="pill-toggle" id="accuracyToggle">
            <button data-accuracy="strict" class="pill-option">Strict</button>
            <button data-accuracy="medium" class="pill-option active">Medium</button>
            <button data-accuracy="liberal" class="pill-option">Liberal</button>
          </div>
        </div>

        <div class="privacy-badge">
          <span class="privacy-dot"></span>
          Clinic-Safe
        </div>
      </div>
    </header>

    <main class="main-layout">
      <!-- LEFT: SOAP OUTPUT -->
      <section class="panel panel-soap">
        <div class="panel-header">
          <h2>SOAP Output</h2>
          <div class="panel-header-actions">
            <button id="generateBtn" class="btn primary">Generate SOAP</button>
            <button id="copyFullBtn" class="btn subtle">Copy full SOAP</button>
            <button id="copyPlanBtn" class="btn subtle">Copy PLAN only</button>
          </div>
        </div>

        <div class="soap-section">
          <div class="soap-label-row">
            <label for="subjectiveOutput">Subjective</label>
            <button class="mini-copy-btn" data-target="subjectiveOutput">Copy</button>
          </div>
          <textarea id="subjectiveOutput" class="soap-textarea" spellcheck="false"></textarea>
        </div>

        <div class="soap-section">
          <div class="soap-label-row">
            <label for="objectiveOutput">Objective</label>
            <button class="mini-copy-btn" data-target="objectiveOutput">Copy</button>
          </div>
          <textarea id="objectiveOutput" class="soap-textarea" spellcheck="false"></textarea>
        </div>

        <div class="soap-section">
          <div class="soap-label-row">
            <label for="assessmentOutput">Assessment</label>
            <button class="mini-copy-btn" data-target="assessmentOutput">Copy</button>
          </div>
          <textarea id="assessmentOutput" class="soap-textarea" spellcheck="false"></textarea>
        </div>

        <div class="soap-section">
          <div class="soap-label-row">
            <label for="planOutput">Plan (includes meds + aftercare)</label>
            <button class="mini-copy-btn" data-target="planOutput">Copy</button>
          </div>
          <textarea id="planOutput" class="soap-textarea soap-plan-big" spellcheck="false"></textarea>
        </div>
      </section>

      <!-- RIGHT: INTAKE + ATTACHMENTS -->
      <section class="panel panel-intake">
        <div class="panel-header">
          <h2>Case Intake</h2>
        </div>

        <div class="intake-row">
          <label for="caseLabelInput">Case label (optional)</label>
          <input id="caseLabelInput" type="text" class="input" placeholder="e.g., Luna spay" />
        </div>

        <div class="intake-row triple">
          <div class="intake-col">
            <label for="speciesSelect">Species</label>
            <select id="speciesSelect" class="input">
              <option value="dog">Dog</option>
              <option value="cat">Cat</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="intake-col">
            <label>Bloodwork</label>
            <div class="chip-row" id="bloodworkChips">
              <button class="chip" data-bw="none">N/A</button>
              <button class="chip" data-bw="normal">Normal</button>
              <button class="chip" data-bw="abnormal">Abnormal</button>
              <button class="chip" data-bw="declined">Declined</button>
            </div>
          </div>

          <div class="intake-col">
            <label>Fluids</label>
            <div class="chip-row" id="fluidChips">
              <button class="chip" data-fluids="unspecified">N/A</button>
              <button class="chip" data-fluids="used">Used</button>
              <button class="chip" data-fluids="declined">Declined</button>
              <button class="chip" data-fluids="owner-aware">Owner aware of risks</button>
            </div>
          </div>
        </div>

        <div class="intake-row">
          <label for="clinicalNotesInput">Core clinical notes</label>
          <textarea
            id="clinicalNotesInput"
            class="input textarea"
            placeholder="Dump PE findings, hx, diagnostics, meds, day-of notes here. Bullet points are fine."
          ></textarea>
        </div>

        <div class="intake-row surgery-only" id="surgeryExtrasRow">
          <label for="surgeryExtrasInput">Surgery extras (if applicable)</label>
          <textarea
            id="surgeryExtrasInput"
            class="input textarea"
            placeholder="Hernia repair, cryptorchid, retained deciduous tooth, complications, extra instructions…"
          ></textarea>
        </div>

        <div class="intake-row">
          <button id="advancedToggle" class="btn link">▾ More options</button>
        </div>

        <div class="advanced-section hidden" id="advancedSection">
          <div class="intake-row">
            <label>Extra flags</label>
            <div class="chip-row" id="extraFlags">
              <button class="chip" data-flag="block-done">Local block done</button>
              <button class="chip" data-flag="high-risk">High anaesthetic risk</button>
              <button class="chip" data-flag="shelter-patient">Shelter patient</button>
            </div>
          </div>
        </div>

        <div class="panel-header attachments-header">
          <h2>Attachments & phone capture</h2>
        </div>

        <div class="attachments-block">
          <div class="attachments-row">
            <label>Add photo from this device</label>
            <input id="fileInput" type="file" accept="image/*" class="file-input" />
            <button id="openRedactFromFileBtn" class="btn subtle small">Open in privacy editor</button>
          </div>

          <div class="attachments-row qr-row">
            <div class="qr-info">
              <label>Phone capture (camera-only)</label>
              <p class="hint">
                Scan this QR with your phone to open a camera-only page for this case (with redaction).
              </p>
              <button id="toggleQrBtn" class="btn subtle small">Show QR</button>
            </div>
            <div id="qrContainer" class="qr-container hidden"></div>
          </div>

          <div class="attachments-row">
            <div class="attachments-header-row">
              <label>Attachments for this case</label>
              <button id="refreshAttachmentsBtn" class="btn subtle small">Refresh</button>
            </div>
            <div id="attachmentsList" class="attachments-thumbs">
              <!-- thumbnails injected here -->
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- PHONE CAPTURE / CAMERA-ONLY MODE -->
  <div id="capture-mode" class="app-root hidden">
    <header class="top-bar capture-bar">
      <div class="top-left">
        <div class="app-title">Lohit Capture Terminal</div>
        <div class="case-id-display">Case: <span id="captureCaseIdLabel"></span></div>
      </div>
      <div class="top-right">
        <div class="privacy-badge">
          <span class="privacy-dot"></span>
          Clinic-Safe
        </div>
      </div>
    </header>

    <main class="capture-layout">
      <section class="panel panel-capture">
        <div class="panel-header">
          <h2>Take or upload a photo</h2>
        </div>

        <p class="hint">
          Use your phone camera to capture bloodwork, anesthesia sheets, consent forms, or other documents.
          You can black-box sensitive info before sending it to the desktop app.
        </p>

        <div class="capture-controls">
          <input
            id="captureFileInput"
            type="file"
            accept="image/*"
            capture="environment"
            class="file-input large"
          />
          <button id="openRedactFromCaptureBtn" class="btn primary">Open in privacy editor</button>
        </div>

        <p class="hint small">
          After saving, the redacted image will appear in the desktop app under this case’s attachments.
        </p>
      </section>
    </main>
  </div>

  <!-- REDACTION MODAL -->
  <div id="redactModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>Privacy editor</h2>
        <button id="closeRedactBtn" class="icon-btn" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <canvas id="redactCanvas"></canvas>
        <p class="hint small">
          Draw black boxes over microchips, owner names, phone numbers, addresses, IDs, signatures, etc.
        </p>
      </div>
      <div class="modal-footer">
        <button id="clearRedactBtn" class="btn subtle">Clear boxes</button>
        <button id="saveRedactBtn" class="btn primary">Save redacted image</button>
      </div>
    </div>
  </div>

  <!-- QR CODE LIBRARY + APP JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="app.js"></script>
</body>
</html>