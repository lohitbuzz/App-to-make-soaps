<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lohit SOAP App v1.6</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <!-- QR code library (small, client-side only) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-left">
        <h1>Lohit SOAP App v1.6</h1>
        <p class="header-subtitle">
          Appointment ¬∑ Surgery ¬∑ Free-form ¬∑ Toolbox Lite
        </p>
      </div>
      <div class="header-right">
        <p class="privacy-pill">Privacy: Local-first ¬∑ Over-redact by default</p>
      </div>
    </header>

    <!-- Top controls -->
    <section class="card">
      <div class="tab-row" id="mainTabs">
        <button id="tabAppointment" class="tab tab-active">Appointment</button>
        <button id="tabSurgery" class="tab">Surgery</button>
        <button id="tabConsult" class="tab">Free-form / Consult</button>
        <button id="tabToolbox" class="tab">Toolbox Lite</button>
      </div>

      <div class="top-row">
        <div class="field-group">
          <label for="caseLabelInput">Case label / Patient name (optional)</label>
          <input
            id="caseLabelInput"
            type="text"
            placeholder="e.g., Milo dental COHAT, 8y MN DSH"
          />
        </div>
        <div class="field-group">
          <label for="modeSelect">Mode</label>
          <select id="modeSelect">
            <option value="help">Help Me (safe assumptions)</option>
            <option value="strict">Strict (no guessing)</option>
          </select>
        </div>
      </div>

      <p id="statusMessage" class="status-message">Ready.</p>
    </section>

    <!-- QR card -->
    <section class="card" id="qrCard">
      <h2>Open on your phone</h2>
      <p>Scan this QR code with your phone camera to open this app and use the camera to attach photos.</p>
      <canvas id="qrCanvas" width="180" height="180"></canvas>
    </section>

    <!-- Appointment section -->
    <section class="card" id="appointmentSection">
      <h2>Appointment SOAP Inputs</h2>

      <div class="two-column">
        <div class="field-group">
          <label for="appointmentReason">Reason for visit</label>
          <input
            id="appointmentReason"
            type="text"
            placeholder="e.g., vomiting, itchy ears, annual exam"
          />
        </div>
        <div class="field-group">
          <label for="appointmentTpr">TPR (optional, no guessing)</label>
          <input
            id="appointmentTpr"
            type="text"
            placeholder="e.g., T 38.7¬∞C, P 110, R 28"
          />
        </div>
      </div>

      <div class="field-group">
        <label for="appointmentQuick">Quick notes (minimal mode)</label>
        <textarea
          id="appointmentQuick"
          rows="3"
          placeholder="Short free-form notes if you don't want full SOAP inputs."
        ></textarea>
      </div>

      <button id="appointmentToggleFull" class="link-button">
        Show full SOAP input fields
      </button>

      <div id="appointmentFull" class="collapse">
        <div class="field-group">
          <label for="appointmentHistory">History / Subjective</label>
          <textarea
            id="appointmentHistory"
            rows="3"
            placeholder="Owner-reported history, duration, diet, meds, etc."
          ></textarea>
        </div>

        <div class="field-group">
          <label for="appointmentPe">Physical exam (data-only)</label>
          <textarea
            id="appointmentPe"
            rows="3"
            placeholder="You can type PE here, or leave blank and let Help Me mode fill safe normals."
          ></textarea>
        </div>

        <div class="field-group">
          <label for="appointmentDiagnostics">Diagnostics (data-only)</label>
          <textarea
            id="appointmentDiagnostics"
            rows="3"
            placeholder="Lab/rads data, cytology, SNAP tests, etc."
          ></textarea>
        </div>

        <div class="field-group">
          <label for="appointmentAssessment">Assessment (optional)</label>
          <textarea
            id="appointmentAssessment"
            rows="3"
            placeholder="Problem list, differentials, severity, etc."
          ></textarea>
        </div>

        <div class="field-group">
          <label for="appointmentPlan">Plan (optional)</label>
          <textarea
            id="appointmentPlan"
            rows="3"
            placeholder="Treatments, diagnostics, follow-up, client communication."
          ></textarea>
        </div>

        <div class="field-group">
          <label for="appointmentMeds">Medications dispensed (optional)</label>
          <textarea
            id="appointmentMeds"
            rows="3"
            placeholder="Include concentration in brackets if you know it."
          ></textarea>
        </div>
      </div>

      <div class="field-group">
        <label>Attachments (optional)</label>
        <div class="file-row">
          <label class="file-button">
            üì∑ Take photo
            <input
              id="appointmentAttachments"
              type="file"
              accept="image/*,application/pdf"
              multiple
            />
          </label>
        </div>
        <p class="hint">
          Use your phone via the QR code to snap Avimark screenshots, lab reports, rads, whiteboard photos, etc.
        </p>
      </div>

      <button id="generateAppointmentBtn" class="primary-button">
        Generate Appointment SOAP
      </button>
    </section>

    <!-- Surgery section -->
    <section class="card hidden" id="surgerySection">
      <h2>Surgery SOAP Inputs</h2>

      <p id="surgeryTemplateBanner" class="template-banner">
        Choose a surgery template to load default expectations (clinic vs rescue, dental, mass, etc.).
      </p>

      <div class="two-column">
        <div class="field-group">
          <label for="surgeryTemplate">Surgery template</label>
          <select id="surgeryTemplate">
            <option value="canine_neuter_clinic">Canine neuter ‚Äì clinic</option>
            <option value="canine_neuter_rescue">Canine neuter ‚Äì rescue</option>
            <option value="canine_spay_clinic">Canine spay ‚Äì clinic</option>
            <option value="canine_spay_rescue">Canine spay ‚Äì rescue</option>
            <option value="feline_neuter">Feline neuter</option>
            <option value="feline_spay">Feline spay</option>
            <option value="pyometra_spay">Pyometra spay</option>
            <option value="cystotomy">Cystotomy</option>
            <option value="enterotomy">Enterotomy</option>
            <option value="gastrotomy">Gastrotomy</option>
            <option value="gastropexy">Gastropexy</option>
            <option value="feline_unblock">Feline urethral unblock</option>
            <option value="dental_cohat_rads">Dental ‚Äì COHAT with radiographs</option>
            <option value="dental_cohat_norads">Dental ‚Äì COHAT (no radiographs)</option>
            <option value="mass_removal">Mass removal / biopsy</option>
            <option value="other">Other / custom</option>
          </select>
        </div>
        <div class="field-group">
          <label for="surgeryAsa">ASA status</label>
          <input
            id="surgeryAsa"
            type="text"
            placeholder="e.g., ASA II"
          />
        </div>
      </div>

      <div class="two-column">
        <div class="field-group">
          <label for="surgeryIvCath">IV catheter</label>
          <input
            id="surgeryIvCath"
            type="text"
            placeholder="e.g., 22g cephalic, left"
          />
        </div>
        <div class="field-group">
          <label for="surgeryEtt">ET tube size</label>
          <input
            id="surgeryEtt"
            type="text"
            placeholder="e.g., 7.5 mm cuffed"
          />
        </div>
      </div>

      <div class="two-column">
        <div class="field-group">
          <label for="surgeryFluids">Fluids rate (ml/kg/hr)</label>
          <input
            id="surgeryFluids"
            type="text"
            placeholder="e.g., 5 ml/kg/hr dogs, 3 ml/kg/hr cats"
          />
        </div>
        <div class="field-group checkbox-field">
          <label>
            <input id="surgeryFluidsDeclined" type="checkbox" />
            Fluids declined
          </label>
        </div>
      </div>

      <div class="collapse-card">
        <button class="collapse-toggle" id="anesthesiaToggle">
          Anesthesia &amp; Premeds
        </button>
        <div id="anesthesiaPanel" class="collapse open">
          <div class="field-group">
            <label for="surgeryPremeds">Premedications</label>
            <textarea
              id="surgeryPremeds"
              rows="2"
              placeholder="e.g., Dexmedetomidine [0.5 mg/ml] + Hydromorphone [2 mg/ml] IM"
            ></textarea>
          </div>

          <div class="field-group">
            <label for="surgeryInduction">Induction / Maintenance</label>
            <textarea
              id="surgeryInduction"
              rows="2"
              placeholder="e.g., Propofol [10 mg/ml] to effect, Isoflurane in oxygen"
            ></textarea>
          </div>

          <div class="field-group">
            <label for="surgeryIntraop">Intra-op medications</label>
            <textarea
              id="surgeryIntraop"
              rows="2"
              placeholder="e.g., Meloxicam [5 mg/ml] SQ, Bupivacaine [0.5%] local blocks"
            ></textarea>
          </div>
        </div>
      </div>

      <div class="collapse-card">
        <button class="collapse-toggle" id="surgeryDetailsToggle">
          Surgery details &amp; intra-op notes
        </button>
        <div id="surgeryDetailsPanel" class="collapse open">
          <div class="field-group">
            <label for="surgeryProcedure">Procedure notes</label>
            <textarea
              id="surgeryProcedure"
              rows="3"
              placeholder="Key surgical findings, complications, closure details, etc."
            ></textarea>
          </div>

          <!-- Dental-only section -->
          <div id="dentalSection" class="hidden">
            <h3 class="section-subtitle">Dental-specific details</h3>
            <div class="field-group">
              <label for="surgeryDentalRads">Dental radiographs</label>
              <select id="surgeryDentalRads">
                <option value="">Select...</option>
                <option value="full_mouth">Full-mouth radiographs performed</option>
                <option value="partial">Selected radiographs performed</option>
                <option value="declined">Radiographs declined</option>
              </select>
            </div>
            <div class="field-group">
              <label for="surgeryDentalExtractions">Extraction / flap notes</label>
              <textarea
                id="surgeryDentalExtractions"
                rows="3"
                placeholder="Teeth extracted, flap type, closure, complications."
              ></textarea>
            </div>
          </div>

          <!-- Mass/cystotomy section -->
          <div id="massSection" class="hidden">
            <h3 class="section-subtitle">Mass / biopsy / cystotomy details</h3>
            <div class="field-group">
              <label for="surgeryMassDetails">Mass / organ description</label>
              <textarea
                id="surgeryMassDetails"
                rows="2"
                placeholder="Location, size, consistency, appearance, margins."
              ></textarea>
            </div>
            <div class="field-group">
              <label for="surgeryHistopath">Histopathology</label>
              <select id="surgeryHistopath">
                <option value="">Select...</option>
                <option value="submitted">Tissue submitted for histopathology</option>
                <option value="not_submitted">Histopathology not submitted</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="field-group">
        <label>Monocryl override</label>
        <div class="checkbox-row">
          <label><input id="mono0Override" type="checkbox" /> 0 Monocryl override</label>
          <label><input id="mono2Override" type="checkbox" /> 2-0 Monocryl override</label>
          <label><input id="mono3Override" type="checkbox" /> 3-0 Monocryl override</label>
        </div>
        <p class="hint">
          Default: 2-0 Monocryl for standard dog neuters; 0 Monocryl for &gt;35 kg, unless overridden.
        </p>
      </div>

      <div class="field-group">
        <label for="surgeryTpr">TPR / intra-op notes (optional)</label>
        <textarea
          id="surgeryTpr"
          rows="2"
          placeholder="Intra-op TPR trends, notable events."
        ></textarea>
      </div>

      <div class="field-group">
        <label for="surgeryDurations">Anesthesia / surgery durations (optional)</label>
        <textarea
          id="surgeryDurations"
          rows="2"
          placeholder="Only if both start &amp; end times known; otherwise leave blank."
        ></textarea>
      </div>

      <div class="field-group">
        <label>Attachments (optional)</label>
        <div class="file-row">
          <label class="file-button">
            üì∑ Take photo
            <input
              id="surgeryAttachments"
              type="file"
              accept="image/*,application/pdf"
              multiple
            />
          </label>
        </div>
      </div>

      <button id="generateSurgeryBtn" class="primary-button">
        Generate Surgery SOAP
      </button>
    </section>

    <!-- Consult / Free-form section -->
    <section class="card hidden" id="consultSection">
      <h2>Free-form / Consult</h2>
      <div class="field-group">
        <label for="consultText">Consult question or free-form request</label>
        <textarea
          id="consultText"
          rows="6"
          placeholder="Describe the case, question, or content you want the AI to draft (e.g., email, note, plan)."
        ></textarea>
      </div>

      <div class="field-group">
        <label>Attachments (optional)</label>
        <div class="file-row">
          <label class="file-button">
            üì∑ Take photo
            <input
              id="consultAttachments"
              type="file"
              accept="image/*,application/pdf"
              multiple
            />
          </label>
        </div>
      </div>

      <button id="runConsultBtn" class="primary-button">
        Run Consult
      </button>

      <div class="field-group">
        <label>Consult output</label>
        <textarea id="consultOutput" rows="8" readonly></textarea>
      </div>
    </section>

    <!-- Toolbox Lite -->
    <section class="card hidden" id="toolboxSection">
      <h2>Toolbox Lite</h2>

      <div class="field-group">
        <label>Attachments (optional)</label>
        <div class="file-row">
          <label class="file-button">
            üì∑ Take photo
            <input
              id="toolboxAttachments"
              type="file"
              accept="image/*,application/pdf"
              multiple
            />
          </label>
        </div>
        <p class="hint">
          Attach lab PDFs, screenshots, or photos of printouts. For now, the helper uses pasted text; photos are for future Vision tools.
        </p>
      </div>

      <h3 class="section-subtitle">Bloodwork Helper Lite</h3>

      <div class="field-group">
        <label for="toolboxLabText">Paste CBC/chem/UA text (optional if photos attached)</label>
        <textarea
          id="toolboxLabText"
          rows="6"
          placeholder="Copy/paste the lab report text or values here."
        ></textarea>
      </div>

      <div class="two-column">
        <div class="field-group">
          <label for="toolboxDetail">Detail level</label>
          <select id="toolboxDetail">
            <option value="short">Short</option>
            <option value="standard">Standard</option>
          </select>
        </div>
        <div class="field-group checkbox-field">
          <label><input id="toolboxIncludeDiffs" type="checkbox" checked /> Include differential list</label>
          <label><input id="toolboxIncludeClient" type="checkbox" /> Add client-friendly summary</label>
        </div>
      </div>

      <button id="runBloodworkBtn" class="primary-button">
        Run Bloodwork Helper
      </button>

      <div class="field-group">
        <label>Bloodwork Helper output</label>
        <textarea id="toolboxOutput" rows="10" readonly></textarea>
      </div>
    </section>

    <!-- SOAP Output -->
    <section class="card" id="soapOutputCard">
      <h2>SOAP Output</h2>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Subjective</span>
          <button class="copy-button" data-copy-target="soapSubjective">Copy</button>
        </div>
        <textarea id="soapSubjective" rows="3" readonly></textarea>
      </div>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Objective</span>
          <button class="copy-button" data-copy-target="soapObjective">Copy</button>
        </div>
        <textarea id="soapObjective" rows="5" readonly></textarea>
      </div>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Assessment</span>
          <button class="copy-button" data-copy-target="soapAssessment">Copy</button>
        </div>
        <textarea id="soapAssessment" rows="4" readonly></textarea>
      </div>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Plan</span>
          <button class="copy-button" data-copy-target="soapPlan">Copy</button>
        </div>
        <textarea id="soapPlan" rows="8" readonly></textarea>
      </div>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Medications Dispensed</span>
          <button class="copy-button" data-copy-target="soapMeds">Copy</button>
        </div>
        <textarea id="soapMeds" rows="3" readonly></textarea>
      </div>

      <div class="soap-row">
        <div class="soap-heading">
          <span>Aftercare</span>
          <button class="copy-button" data-copy-target="soapAftercare">Copy</button>
        </div>
        <textarea id="soapAftercare" rows="4" readonly></textarea>
      </div>

      <div class="output-actions">
        <button id="copyFullSoapBtn" class="secondary-button">Copy full SOAP</button>
        <button id="copyPlanMedsAftercareBtn" class="secondary-button">
          Copy Plan + Meds + Aftercare
        </button>
      </div>
    </section>

    <!-- Floating mic button -->
    <button id="micButton" class="mic-fab" title="Dictate into last active field">
      üéôÔ∏è
    </button>
  </div>

  <script src="app.js"></script>
</body>
</html>