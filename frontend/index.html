<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moksha SOAP – Lohit SOAP App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #030912;
      --card: #081621;
      --card-soft: #08131d;
      --accent: #19c2a6;
      --accent-soft: rgba(25, 194, 166, 0.1);
      --danger: #ff4f6a;
      --text: #f5f9ff;
      --text-soft: #a3b4c8;
      --border-subtle: rgba(255,255,255,0.04);
      --pill: #101f2c;
      --radius-card: 18px;
      --radius-pill: 999px;
      --shadow-card: 0 20px 60px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top left, #102532 0, #030912 55%, #010308 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    body {
      padding: 16px;
    }

    #app {
      max-width: 1200px;
      margin: 0 auto 48px;
    }

    /* HEADER */

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 20px;
      border-radius: var(--radius-card);
      background: radial-gradient(circle at top left, #143541, #07141c 55%, #030910 100%);
      box-shadow: var(--shadow-card);
      margin-bottom: 16px;
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .app-logo {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      object-fit: contain;
      background: transparent;
      flex-shrink: 0;
    }

    .app-title h1 {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 0;
    }

    .app-title p {
      margin: 2px 0 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .app-status {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.78rem;
      color: var(--text-soft);
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #666;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .status-ok {
      background: #18c47c;
      box-shadow: 0 0 12px rgba(24,196,124,0.9);
    }

    .version-pill {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: var(--pill);
      border: 1px solid rgba(255,255,255,0.06);
    }

    /* TABS */

    .primary-tabs {
      display: inline-flex;
      gap: 6px;
      padding: 4px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      margin-bottom: 12px;
    }

    .tab-btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tab-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .pill-label {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.03);
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    /* LAYOUT */

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-card);
      padding: 16px 18px 18px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-header h2 {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin: 0;
      color: var(--text-soft);
    }

    .sub-label {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    /* FORMS */

    .field-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .field-row-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      background: #050d15;
      color: var(--text);
      padding: 8px 10px;
      font-size: 0.84rem;
      outline: none;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: #4b5a6a;
    }

    .toggle-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .toggle-group {
      display: inline-flex;
      border-radius: 999px;
      padding: 3px;
      background: rgba(0,0,0,0.35);
      gap: 3px;
    }

    .toggle-btn {
      border-radius: 999px;
      padding: 6px 14px;
      border: none;
      cursor: pointer;
      background: transparent;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .toggle-btn.active {
      background: var(--accent);
      color: #031015;
    }

    .small-note {
      font-size: 0.74rem;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 18px;
      font-size: 0.86rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      background: var(--accent);
      color: #031015;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(25,194,166,0.4);
    }

    .btn-secondary {
      background: #111e28;
      color: var(--text-soft);
      box-shadow: none;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--text-soft);
      box-shadow: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .mt-10 {
      margin-top: 10px;
    }

    .mt-12 {
      margin-top: 12px;
    }

    .mt-16 {
      margin-top: 16px;
    }

    /* OUTPUT */

    .output-box {
      border-radius: 14px;
      background: #050d15;
      border: 1px solid rgba(255,255,255,0.04);
      padding: 12px 12px 18px;
      min-height: 160px;
      font-size: 0.85rem;
      white-space: pre-wrap;
      overflow-y: auto;
    }

    .output-placeholder {
      color: #4b5a6a;
    }

    .output-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      align-items: center;
    }

    .status-pill {
      font-size: 0.74rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      color: var(--text-soft);
    }

    .feedback-card {
      margin-top: 14px;
      padding: 10px 12px 12px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(25,194,166,0.06), rgba(8,15,25,0.9));
      border: 1px dashed rgba(25,194,166,0.3);
    }

    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .feedback-header span {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      background: rgba(25,194,166,0.15);
      color: var(--accent);
    }

    /* RELAY */

    .relay-card {
      margin-top: 14px;
      padding: 10px 12px 12px;
      border-radius: 14px;
      background: #050c14;
      border: 1px solid rgba(255,255,255,0.04);
      font-size: 0.8rem;
    }

    .relay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .relay-id-row {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }

    .relay-id-row input {
      flex: 1;
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
    }

    .relay-btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .hidden {
      display: none !important;
    }

    /* TOOLBOX / CONSULT SIMPLE STYLES */

    .toolbox-body,
    .consult-body {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .select-inline {
      max-width: 220px;
    }
  </style>
</head>
<body>
<div id="app">
  <!-- HEADER -->
  <header class="app-header">
    <div class="app-header-left">
      <!-- Make sure moksha-soap-logo.png is in the same folder as index.html -->
      <img src="moksha-soap-logo.png" alt="Moksha SOAP logo" class="app-logo" />
      <div class="app-title">
        <h1>Moksha SOAP</h1>
        <p>Lohit SOAP App · SOAP · Toolbox · Consult · Phone ↔ Desktop</p>
      </div>
    </div>
    <div class="app-status">
      <span id="backend-status-dot" class="status-dot status-ok"></span>
      <span id="backend-status-text">Backend reachable</span>
      <span class="version-pill">v1.7.6 · Hybrid UI + Recorder</span>
    </div>
  </header>

  <!-- TABS -->
  <div class="primary-tabs">
    <button class="tab-btn active" data-tab="soap-tab" id="tab-soap">SOAP</button>
    <button class="tab-btn" data-tab="toolbox-tab" id="tab-toolbox">Toolbox</button>
    <button class="tab-btn" data-tab="consult-tab" id="tab-consult">Consult</button>
  </div>

  <div class="layout">
    <!-- LEFT: INPUT AREA -->
    <section>
      <!-- SOAP TAB -->
      <div id="soap-tab" class="card">
        <div class="card-header">
          <h2>SOAP Input</h2>
          <span class="sub-label">Appointment · Surgery · Voice</span>
        </div>

        <div class="toggle-row">
          <div class="toggle-group" id="visit-type-toggle">
            <button class="toggle-btn active" data-visit="appointment">Appointment</button>
            <button class="toggle-btn" data-visit="surgery">Surgery</button>
          </div>
          <div class="toggle-group" id="surgery-mode-toggle">
            <button class="toggle-btn active" data-mode="simple">Simple</button>
            <button class="toggle-btn" data-mode="advanced">Advanced</button>
          </div>
        </div>

        <div class="field-row">
          <div class="field">
            <label>Case label</label>
            <input type="text" id="case-label" placeholder="e.g. Bella – Spay recheck" />
          </div>
          <div class="field">
            <label>Patient name</label>
            <input type="text" id="patient-name" placeholder="e.g. Bella" />
          </div>
        </div>

        <div class="field-row-3">
          <div class="field">
            <label>Species</label>
            <select id="species">
              <option value="">Select species</option>
              <option>Canine</option>
              <option>Feline</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label>Sex</label>
            <select id="sex">
              <option value="">Sex</option>
              <option>Male</option>
              <option>Female</option>
              <option>Male neutered</option>
              <option>Female spayed</option>
            </select>
          </div>
          <div class="field">
            <label>Weight (kg)</label>
            <input type="number" id="weight" placeholder="e.g. 6.4" step="0.01" />
          </div>
        </div>

        <div class="field-row-3">
          <div class="field">
            <label>ASA (surgery)</label>
            <select id="asa">
              <option value="">Select ASA</option>
              <option>I</option>
              <option>II</option>
              <option>III</option>
              <option>IV</option>
              <option>V</option>
            </select>
          </div>
          <div class="field">
            <label>Appointment preset</label>
            <select id="appointment-preset">
              <option value="custom">Custom / blank</option>
              <option value="wellness">Wellness / vaccines</option>
              <option value="gi">GI upset</option>
              <option value="derm">Derm / otitis</option>
              <option value="cough">Cough / URI</option>
              <option value="lameness">Lameness</option>
              <option value="senior">Senior / multi-issue</option>
              <option value="recheck">Recheck</option>
            </select>
          </div>
          <div class="field">
            <label>Surgery preset</label>
            <select id="surgery-preset">
              <option value="custom">Custom surgery</option>
              <option value="canine-spay">Canine spay</option>
              <option value="canine-neuter">Canine neuter</option>
              <option value="feline-spay">Feline spay</option>
              <option value="feline-neuter">Feline neuter</option>
              <option value="dental-rads">Dental – COHAT with rads</option>
              <option value="dental-no-rads">Dental – COHAT (no rads)</option>
              <option value="mass-removal">Mass removal</option>
              <option value="cystotomy">Cystotomy</option>
              <option value="pyometra">Pyometra spay</option>
              <option value="exploratory">Exploratory laparotomy</option>
              <option value="enterotomy">Enterotomy</option>
              <option value="gastrotomy">Gastrotomy</option>
              <option value="gastropexy">Gastropexy</option>
              <option value="feline-block">Feline urethral unblock</option>
            </select>
          </div>
        </div>

        <div class="field mt-10">
          <label><input type="checkbox" id="vaccines-today" /> Vaccines done today</label>
          <div class="small-note">Used to auto-open vaccine SOAP style for wellness exams.</div>
        </div>

        <div class="field">
          <label>Core notes / history</label>
          <textarea id="core-notes" placeholder="Why are they here today? Pertinent history, owner concerns, context."></textarea>
        </div>

        <div class="field">
          <label>PE & diagnostics (data only)</label>
          <textarea id="pe-notes" placeholder="Include PE systems list, diagnostic results, vitals – values only, no interpretation."></textarea>
        </div>

        <div class="field">
          <label>Assessment hints</label>
          <textarea id="assessment-hints" placeholder="What are you worried about? Rule-outs, problem list, ASA grade for anesthesia cases."></textarea>
        </div>

        <div class="field">
          <label>Plan & discharge hints</label>
          <textarea id="plan-hints" placeholder="Diagnostics, treatments, procedures, recheck timing, what you told the owner, activity restrictions."></textarea>
        </div>

        <div class="field">
          <label>Extra instructions / anything else</label>
          <textarea id="extra-notes" placeholder="Edge cases, special instructions, inventory notes, anything weird or important."></textarea>
        </div>

        <details class="mt-10">
          <summary class="small-note">External transcript (optional – paste Covet transcript or call log)</summary>
          <textarea id="external-transcript" class="mt-10"></textarea>
        </details>

        <details class="mt-10">
          <summary class="small-note">Voice notes (optional – paste transcript)</summary>
          <textarea id="voice-notes" class="mt-10"></textarea>
        </details>

        <button id="generate-soap-btn" class="btn btn-full mt-16">Generate SOAP</button>
      </div>

      <!-- TOOLBOX TAB -->
      <div id="toolbox-tab" class="card hidden">
        <div class="card-header">
          <h2>Toolbox</h2>
          <span class="sub-label">Bloodwork · Emails · Discharges</span>
        </div>
        <div class="toolbox-body">
          <div class="field-row">
            <div class="field select-inline">
              <label>Tool</label>
              <select id="toolbox-tool">
                <option value="bw-summary">Bloodwork helper – summary</option>
                <option value="bw-expanded">Bloodwork helper – expanded + DDx</option>
                <option value="email-client">Client email / call note</option>
                <option value="handout">Client handout / instructions</option>
              </select>
            </div>
          </div>
          <div class="field">
            <label>Paste data or notes</label>
            <textarea id="toolbox-input" placeholder="Paste bloodwork, notes, or prompt for what you want."></textarea>
          </div>
          <button id="toolbox-generate-btn" class="btn btn-full mt-12">Generate via Toolbox</button>
        </div>
      </div>

      <!-- CONSULT TAB -->
      <div id="consult-tab" class="card hidden">
        <div class="card-header">
          <h2>Consult</h2>
          <span class="sub-label">Ask Moksha SOAP anything</span>
        </div>
        <div class="consult-body">
          <div class="field">
            <label>Consult question / scenario</label>
            <textarea id="consult-input" placeholder="Describe the case or question."></textarea>
          </div>
          <button id="consult-generate-btn" class="btn btn-full mt-12">Generate consult answer</button>
        </div>
      </div>
    </section>

    <!-- RIGHT: OUTPUT, FEEDBACK, RELAY -->
    <section>
      <div class="card">
        <div class="card-header">
          <h2>Output · AI Brain – SOAP</h2>
          <span class="sub-label" id="output-status-pill">Ready</span>
        </div>
        <div id="output-box" class="output-box">
          <div class="output-placeholder">SOAP / Toolbox / Consult output will appear here.</div>
        </div>

        <div class="output-actions">
          <button id="copy-full-btn" class="btn-secondary btn">
            Copy full SOAP / output
          </button>
          <button id="copy-plan-btn" class="btn-secondary btn">
            Copy Plan + Meds + Aftercare
          </button>
          <button id="send-to-desktop-btn" class="btn-ghost btn">
            Send output to desktop
          </button>
          <span class="status-pill" id="output-mini-status">Ready</span>
        </div>

        <!-- FEEDBACK -->
        <div class="feedback-card">
          <div class="feedback-header">
            <span>Feedback to Moksha SOAP</span>
            <span class="badge">Brain tuning (local only)</span>
          </div>
          <textarea id="feedback-text" placeholder="What would you change in this output? Missing details, tone, formatting, etc." rows="3"></textarea>
          <button id="apply-feedback-btn" class="btn btn-full mt-10">Apply feedback &amp; refine</button>
        </div>

        <!-- RELAY -->
        <div class="relay-card">
          <div class="relay-header">
            <span>Phone ↔ Desktop relay · Uploads</span>
            <span class="pill-label">Clinic-only</span>
          </div>
          <div class="relay-id-row">
            <input type="text" id="relay-id" placeholder="Relay ID (auto or custom)" />
            <button id="new-relay-id-btn" class="btn-secondary">New</button>
          </div>
          <div class="relay-btn-row">
            <button id="receive-text-btn" class="btn-secondary">Receive text from phone</button>
            <button id="receive-files-btn" class="btn-secondary">Receive files from phone</button>
            <button id="upload-from-device-btn" class="btn-secondary">Upload from this device</button>
          </div>
          <div class="small-note mt-10" id="relay-status-text">
            No files uploaded yet. Use “Send output to desktop” on your phone, then “Receive text from phone” here.
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
  // --- tiny helpers ---
  function $(id) { return document.getElementById(id); }

  function setOutput(text) {
    const box = $('output-box');
    box.innerHTML = '';
    const pre = document.createElement('pre');
    pre.textContent = text;
    box.appendChild(pre);
  }

  function setStatus(text) {
    $('output-status-pill').textContent = text;
    $('output-mini-status').textContent = text;
  }

  async function callBackend(path, payload) {
    try {
      setStatus('Thinking…');
      const res = await fetch(path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload || {})
      });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      setOutput(data.text || data.output || '[No text returned]');
      setStatus('Ready');
    } catch (err) {
      console.error(err);
      setOutput('Error calling backend: ' + err.message);
      setStatus('Error');
    }
  }

  // --- tabs ---
  function setupTabs() {
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tabId = btn.dataset.tab;
        document.querySelectorAll('#soap-tab, #toolbox-tab, #consult-tab').forEach(sec => {
          sec.classList.add('hidden');
        });
        document.getElementById(tabId).classList.remove('hidden');
      });
    });
  }

  // --- visit / surgery mode toggles ---
  function setupToggles() {
    const visitButtons = document.querySelectorAll('#visit-type-toggle .toggle-btn');
    visitButtons.forEach(b => {
      b.addEventListener('click', () => {
        visitButtons.forEach(x => x.classList.remove('active'));
        b.classList.add('active');
      });
    });

    const modeButtons = document.querySelectorAll('#surgery-mode-toggle .toggle-btn');
    modeButtons.forEach(b => {
      b.addEventListener('click', () => {
        modeButtons.forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        const isAdvanced = b.dataset.mode === 'advanced';
        // In a later version you can show/hide detailed anesthesia fields here.
        console.log('Surgery mode =', isAdvanced ? 'Advanced' : 'Simple');
      });
    });
  }

  // --- SOAP generate ---
  function setupSoapGenerate() {
    $('generate-soap-btn').addEventListener('click', () => {
      const visitType = document.querySelector('#visit-type-toggle .toggle-btn.active').dataset.visit;
      const mode = document.querySelector('#surgery-mode-toggle .toggle-btn.active').dataset.mode;
      const payload = {
        visitType,
        mode,
        caseLabel: $('case-label').value,
        patientName: $('patient-name').value,
        species: $('species').value,
        sex: $('sex').value,
        weightKg: $('weight').value,
        asa: $('asa').value,
        appointmentPreset: $('appointment-preset').value,
        surgeryPreset: $('surgery-preset').value,
        vaccinesToday: $('vaccines-today').checked,
        coreNotes: $('core-notes').value,
        peNotes: $('pe-notes').value,
        assessmentHints: $('assessment-hints').value,
        planHints: $('plan-hints').value,
        extraNotes: $('extra-notes').value,
        externalTranscript: $('external-transcript').value,
        voiceNotes: $('voice-notes').value
      };
      callBackend('/api/soap', payload);
    });
  }

  // --- Toolbox ---
  function setupToolbox() {
    $('toolbox-generate-btn').addEventListener('click', () => {
      const payload = {
        tool: $('toolbox-tool').value,
        text: $('toolbox-input').value
      };
      callBackend('/api/toolbox', payload);
    });
  }

  // --- Consult ---
  function setupConsult() {
    $('consult-generate-btn').addEventListener('click', () => {
      const payload = { question: $('consult-input').value };
      callBackend('/api/consult', payload);
    });
  }

  // --- Copy buttons ---
  function setupCopyButtons() {
    $('copy-full-btn').addEventListener('click', async () => {
      const text = $('output-box').innerText || '';
      try {
        await navigator.clipboard.writeText(text);
        $('output-mini-status').textContent = 'Copied full output';
      } catch {
        $('output-mini-status').textContent = 'Copy failed';
      }
    });

    $('copy-plan-btn').addEventListener('click', async () => {
      const text = $('output-box').innerText || '';
      // Dumb split: in your real server output you’ll keep Plan / Meds / Aftercare group.
      const idx = text.indexOf('Plan:');
      const slice = idx >= 0 ? text.slice(idx) : text;
      try {
        await navigator.clipboard.writeText(slice);
        $('output-mini-status').textContent = 'Copied Plan + Meds + Aftercare';
      } catch {
        $('output-mini-status').textContent = 'Copy failed';
      }
    });
  }

  // --- Feedback ---
  function setupFeedback() {
    $('apply-feedback-btn').addEventListener('click', () => {
      const fb = $('feedback-text').value.trim();
      if (!fb) return;
      const current = $('output-box').innerText || '';
      const combined = current + '\n\n---\nFeedback notes:\n' + fb;
      setOutput(combined);
      $('feedback-text').value = '';
      $('output-mini-status').textContent = 'Feedback attached (local only)';
    });
  }

  // --- Relay (local-only demo; your server can replace this with real endpoints) ---
  function setupRelay() {
    const relayInput = $('relay-id');

    $('new-relay-id-btn').addEventListener('click', () => {
      const id = 'R' + Math.random().toString(36).slice(2, 8).toUpperCase();
      relayInput.value = id;
      $('relay-status-text').textContent = 'New relay ID created. Use this on your phone and desktop.';
    });

    // “Send output to desktop” simply stores in localStorage under relay ID
    $('send-to-desktop-btn').addEventListener('click', () => {
      const id = relayInput.value.trim() || 'LOCAL';
      const text = $('output-box').innerText || '';
      if (!text) {
        $('output-mini-status').textContent = 'No output to send';
        return;
      }
      localStorage.setItem('mokshaRelay:' + id, text);
      $('relay-status-text').textContent = 'Output stored under relay ID ' + id + ' (local demo).';
      $('output-mini-status').textContent = 'Sent to relay (local demo)';
    });

    $('receive-text-btn').addEventListener('click', () => {
      const id = relayInput.value.trim() || 'LOCAL';
      const text = localStorage.getItem('mokshaRelay:' + id);
      if (!text) {
        $('relay-status-text').textContent = 'No text stored for relay ID ' + id + '.';
        return;
      }
      setOutput(text);
      $('relay-status-text').textContent = 'Received text from relay ID ' + id + '.';
    });

    $('receive-files-btn').addEventListener('click', () => {
      $('relay-status-text').textContent = 'File relay not wired in this demo. Use local uploads.';
    });

    $('upload-from-device-btn').addEventListener('click', () => {
      $('relay-status-text').textContent = 'For now, attach files directly in the SOAP app or use local tools.';
    });
  }

  // INIT
  document.addEventListener('DOMContentLoaded', () => {
    setupTabs();
    setupToggles();
    setupSoapGenerate();
    setupToolbox();
    setupConsult();
    setupCopyButtons();
    setupFeedback();
    setupRelay();
  });
</script>
</body>
</html>