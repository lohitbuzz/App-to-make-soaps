<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moksha SOAP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="header">
  <div class="header-left">
    <img src="logo.PNG" alt="Moksha SOAP" class="logo" />
    <div class="header-text">
      <h1 class="app-title">Moksha SOAP</h1>
      <p class="app-subtitle">Vet-first SOAPs ¬∑ Surgery ¬∑ Toolbox ¬∑ Consult</p>
    </div>
  </div>
  <div class="header-right">
    <div id="statusMessage" class="status-line">Ready.</div>
    <a href="feedback.html" class="feedback-link">Feedback ‚Üó</a>
  </div>
</header>

<main class="main-layout">
  <!-- LEFT COLUMN: TABS + CONTENT -->
  <section class="main-left">
    <!-- TAB BUTTONS -->
    <div class="tab-bar">
      <button class="tab-button active" data-tab-target="appointmentTab">Appointment</button>
      <button class="tab-button" data-tab-target="surgeryTab">Surgery</button>
      <button class="tab-button" data-tab-target="toolboxTab">Toolbox</button>
      <button class="tab-button" data-tab-target="consultTab">Consult</button>
      <button class="tab-button" data-tab-target="transferTab">Phone ‚Üí Desktop</button>
    </div>

    <!-- APPOINTMENT TAB -->
    <section id="appointmentTab" class="tab-panel">
      <div class="card">
        <h2>Appointment SOAP</h2>
        <p class="hint-text">
          Minimal inputs ‚Üí Avimark-friendly SOAP. Diagnostics stay data-only in Objective; interpretation goes to Assessment.
        </p>

        <div class="upload-row">
          <div>
            <label class="field-label">Attachments (photos / PDFs / lab / Avimark screenshots)</label>
            <input id="apptFiles" type="file" multiple />
            <p class="hint-text small">
              You can select multiple images. Vision will try to read any clear lab sheets / UA / reports from them.
              Non-image files are sent by name only.
            </p>
          </div>
          <button class="secondary-btn" type="button" data-privacy-target="apptFiles">
            ‚úèÔ∏è Privacy / Redact
          </button>
        </div>

        <div class="grid-2">
          <div>
            <label class="field-label" for="apptReason">Reason for visit</label>
            <textarea id="apptReason" rows="2" placeholder="e.g. vomiting, wellness exam, ear infection"></textarea>
          </div>
          <div>
            <label class="field-label" for="apptHistory">History</label>
            <textarea id="apptHistory" rows="4" placeholder="Owner concerns, duration, medications, prior issues"></textarea>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label class="field-label" for="apptPE">Physical exam (data-only)</label>
            <textarea id="apptPE" rows="5" placeholder="General, Vitals, Eyes, Ears, Oral, Nose, Resp, CV, Abd, UG, MSK, Neuro, Integ, Lymph"></textarea>
          </div>
          <div>
            <label class="field-label" for="apptDiagnostics">Diagnostics (data-only)</label>
            <textarea id="apptDiagnostics" rows="5" placeholder="Lab values, urinalysis, imaging findings. Interpretation will go in Assessment."></textarea>
          </div>
        </div>

        <div class="grid-3">
          <div>
            <label class="field-label" for="apptAssessmentHints">Assessment hints (optional)</label>
            <textarea id="apptAssessmentHints" rows="3" placeholder="Differentials, suspected diagnosis, rule-outs..."></textarea>
          </div>
          <div>
            <label class="field-label" for="apptPlanHints">Plan hints (optional)</label>
            <textarea id="apptPlanHints" rows="3" placeholder="Tests, treatments, follow-up plan..."></textarea>
          </div>
          <div>
            <label class="field-label" for="apptMedsHints">Meds dispensed hints (optional)</label>
            <textarea id="apptMedsHints" rows="3" placeholder="e.g. Apoquel, Metacam, antibiotics, etc."></textarea>
          </div>
        </div>

        <div class="button-row">
          <button id="generateApptSoapBtn" type="button" class="primary-btn">
            ü©∫ Generate Appointment SOAP
          </button>
        </div>

        <section class="output-section">
          <div class="output-header">
            <h3>Appointment SOAP output</h3>
            <div class="output-actions">
              <button id="copyApptSoapBtn" type="button" class="secondary-btn small">Copy full SOAP</button>
            </div>
          </div>
          <textarea id="apptSoapOutput" class="soap-output" placeholder="SOAP will appear here..." rows="14"></textarea>
        </section>

        <details class="extras">
          <summary>‚ú® Additional outputs from this SOAP</summary>
          <p class="hint-text small">
            These reuse the same SOAP content to create client-facing pieces.
          </p>
          <div class="chip-row">
            <button class="chip-btn" type="button" data-transform="email" data-target="apptSoapOutput">
              ‚úâÔ∏è Client email version
            </button>
            <button class="chip-btn" type="button" data-transform="summary" data-target="apptSoapOutput">
              üìù Short summary
            </button>
            <button class="chip-btn" type="button" data-transform="handout" data-target="apptSoapOutput">
              üë®‚Äçüë©‚Äçüëß Client handout
            </button>
            <button class="chip-btn" type="button" data-transform="plan-meds-aftercare" data-target="apptSoapOutput">
              üìã Plan + Meds + Aftercare
            </button>
            <button class="chip-btn" type="button" data-transform="rephrase" data-target="apptSoapOutput">
              ‚ôªÔ∏è Rephrase / simplify
            </button>
          </div>
          <label class="field-label" for="apptTransformOutput">Transformed text</label>
          <textarea id="apptTransformOutput" class="soap-output" rows="8" placeholder="Transformed output will appear here..."></textarea>
          <div class="button-row">
            <button id="copyApptTransformBtn" type="button" class="secondary-btn small">
              Copy transformed text
            </button>
          </div>
        </details>

        <section class="feedback-section">
          <label class="field-label" for="apptSoapFeedbackInput">Refine / improve this SOAP</label>
          <textarea id="apptSoapFeedbackInput" class="feedback-box" rows="3" placeholder="e.g. 'Less wordy', 'Highlight diarrhea more', 'Tone down assessment'"></textarea>
          <div class="button-row">
            <button id="improveApptSoapBtn" type="button" class="secondary-btn">Refine SOAP</button>
          </div>
        </section>
      </div>
    </section>

    <!-- SURGERY TAB -->
    <section id="surgeryTab" class="tab-panel hidden">
      <div class="card">
        <h2>Surgery / Anesthesia SOAP</h2>
        <p class="hint-text">
          Plan section will always use your fixed anesthesia layout (IV catheter/fluids ‚Üí Pre-meds ‚Üí Induction/Maintenance ‚Üí Surgical Prep ‚Üí Procedure ‚Üí Intra-op meds ‚Üí Recovery ‚Üí Meds Dispensed ‚Üí Aftercare).
        </p>

        <div class="upload-row">
          <div>
            <label class="field-label">Attachments (anesthesia sheet / rads / labs / Avimark)</label>
            <input id="sxFiles" type="file" multiple />
            <p class="hint-text small">
              You can attach multiple anesthesia sheet photos or rads screenshots. Vision will try to read any legible numbers/text.
            </p>
          </div>
          <button class="secondary-btn" type="button" data-privacy-target="sxFiles">
            ‚úèÔ∏è Privacy / Redact
          </button>
        </div>

        <div class="grid-2">
          <div>
            <label class="field-label" for="sxReason">Reason for surgery</label>
            <textarea id="sxReason" rows="2" placeholder="e.g. canine spay, mass removal, pyometra, COHAT"></textarea>
          </div>
          <div>
            <label class="field-label" for="sxHistory">Surgical history / notes</label>
            <textarea id="sxHistory" rows="3" placeholder="Relevant history, prior anesthetics, concerns"></textarea>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label class="field-label" for="sxPE">Physical exam (data-only)</label>
            <textarea id="sxPE" rows="5" placeholder="System-based PE (General ‚Üí Vitals ‚Üí Eyes ‚Üí ... ‚Üí Lymphatic)"></textarea>
          </div>
          <div>
            <label class="field-label" for="sxDiagnostics">Diagnostics (data-only)</label>
            <textarea id="sxDiagnostics" rows="5" placeholder="Pre-anesthetic bloodwork, rads, ultrasound, etc. Data only. Interpretation goes in Assessment."></textarea>
          </div>
        </div>

        <div class="sx-top-row">
          <div>
            <label class="field-label" for="sxPreset">Surgery template</label>
            <select id="sxPreset">
              <option value="">-- None / custom --</option>
              <option value="canine-spay">Canine spay</option>
              <option value="canine-neuter">Canine neuter</option>
              <option value="feline-spay">Feline spay</option>
              <option value="feline-neuter">Feline neuter</option>
              <option value="dental-cohat">Dental ‚Äì COHAT (with or without rads)</option>
              <option value="mass-removal">Mass removal</option>
              <option value="cystotomy">Cystotomy</option>
              <option value="pyometra-spay">Pyometra spay</option>
              <option value="exploratory-laparotomy">Exploratory laparotomy</option>
              <option value="enterotomy">Enterotomy</option>
              <option value="gastrotomy">Gastrotomy</option>
              <option value="gastropexy">Gastropexy</option>
              <option value="feline-unblock">Feline urethral unblock</option>
            </select>
          </div>

          <div class="sx-mode-toggle">
            <span class="field-label">Anesthesia detail level</span>
            <div class="chip-row">
              <button type="button" class="chip-btn sx-mode-btn active" data-sx-mode="simple">
                Simple
              </button>
              <button type="button" class="chip-btn sx-mode-btn" data-sx-mode="advanced">
                Advanced
              </button>
            </div>
            <p class="hint-text small">
              Simple: minimal hints, safe defaults. Advanced: specify premed, induction, fluids, etc.
            </p>
          </div>
        </div>

        <!-- ADVANCED BLOCK -->
        <div id="sxAdvancedBlock" class="advanced-block hidden">
          <h3>Anesthesia details (Advanced)</h3>

          <div class="grid-2">
            <div>
              <label class="field-label" for="sxPremed">Premed protocol</label>
              <select id="sxPremed">
                <option value="">-- Not specified --</option>
                <option value="tdk-1-1-1-1">TDK 1:1:1:1 (Torbugesic, Dexmedetomidine, Ketamine + saline) ‚Äì cats</option>
                <option value="methadone-midazolam">Methadone + Midazolam</option>
                <option value="methadone-dexmedetomidine">Methadone + Dexmedetomidine</option>
                <option value="hydromorphone-midazolam">Hydromorphone + Midazolam</option>
                <option value="hydromorphone-dexmedetomidine">Hydromorphone + Dexmedetomidine</option>
                <option value="buprenorphine-sr">Buprenorphine SR (post-op only)</option>
              </select>
            </div>
            <div>
              <label class="field-label" for="sxInduction">Induction / maintenance</label>
              <select id="sxInduction">
                <option value="">-- Not specified --</option>
                <option value="propofol">Propofol induction ‚Üí Isoflurane maintenance</option>
                <option value="alfaxan">Alfaxan induction ‚Üí Isoflurane maintenance</option>
                <option value="ketamine-diazepam">Ketamine + Diazepam induction ‚Üí Isoflurane maintenance</option>
              </select>
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label class="field-label" for="sxFluids">Fluids (rate & type)</label>
              <input id="sxFluids" type="text" placeholder="e.g. LRS 5 mL/kg/hr (dogs), 3 mL/kg/hr (cats)" />
            </div>
            <div>
              <label class="field-label" for="sxLines">IV catheter / ETT</label>
              <input id="sxLines" type="text" placeholder="e.g. 20g cephalic IV, 7.5 mm ETT" />
            </div>
          </div>

          <div class="grid-3">
            <div>
              <label class="field-label" for="sxIntraOp">Intra-op medications</label>
              <textarea id="sxIntraOp" rows="3" placeholder="CRI, local blocks, additional opioids, etc."></textarea>
            </div>
            <div>
              <label class="field-label" for="sxPostOp">Post-op medications</label>
              <textarea id="sxPostOp" rows="3" placeholder="NSAIDs, buprenorphine SR, gastroprotectants, etc."></textarea>
            </div>
            <div>
              <label class="field-label" for="sxRecovery">Recovery notes</label>
              <textarea id="sxRecovery" rows="3" placeholder="Recovery quality, dysphoria, redosed Dexmedetomidine, etc."></textarea>
            </div>
          </div>

          <div>
            <label class="field-label" for="sxProcedureNotes">Surgical procedure notes</label>
            <textarea id="sxProcedureNotes" rows="4" placeholder="Incision, surgical approach, findings, closure details..."></textarea>
          </div>

          <div>
            <label class="field-label" for="sxMedsDispensed">Medications dispensed (take-home)</label>
            <textarea id="sxMedsDispensed" rows="3" placeholder="Name, dose, frequency, duration. Concentration will be added in brackets automatically."></textarea>
          </div>
        </div>

        <div class="button-row">
          <button id="generateSxSoapBtn" type="button" class="primary-btn">
            ü©ª Generate Surgery SOAP
          </button>
        </div>

        <section class="output-section">
          <div class="output-header">
            <h3>Surgery SOAP output</h3>
            <div class="output-actions">
              <button id="copySxSoapBtn" type="button" class="secondary-btn small">Copy full SOAP</button>
            </div>
          </div>
          <textarea id="sxSoapOutput" class="soap-output" rows="16" placeholder="Surgery SOAP will appear here..."></textarea>
        </section>

        <details class="extras">
          <summary>‚ú® Additional outputs from this SOAP</summary>
          <p class="hint-text small">
            Use surgery SOAP to create discharge-ready pieces.
          </p>
          <div class="chip-row">
            <button class="chip-btn" type="button" data-transform="email" data-target="sxSoapOutput">
              ‚úâÔ∏è Client email version
            </button>
            <button class="chip-btn" type="button" data-transform="summary" data-target="sxSoapOutput">
              üìù Short summary
            </button>
            <button class="chip-btn" type="button" data-transform="handout" data-target="sxSoapOutput">
              üë®‚Äçüë©‚Äçüëß Client handout
            </button>
            <button class="chip-btn" type="button" data-transform="plan-meds-aftercare" data-target="sxSoapOutput">
              üìã Plan + Meds + Aftercare
            </button>
            <button class="chip-btn" type="button" data-transform="rephrase" data-target="sxSoapOutput">
              ‚ôªÔ∏è Rephrase / simplify
            </button>
          </div>
          <label class="field-label" for="sxTransformOutput">Transformed text</label>
          <textarea id="sxTransformOutput" class="soap-output" rows="8" placeholder="Transformed output will appear here..."></textarea>
          <div class="button-row">
            <button id="copySxTransformBtn" type="button" class="secondary-btn small">
              Copy transformed text
            </button>
          </div>
        </details>

        <section class="feedback-section">
          <label class="field-label" for="sxSoapFeedbackInput">Refine / improve this Surgery SOAP</label>
          <textarea id="sxSoapFeedbackInput" class="feedback-box" rows="3" placeholder="e.g. 'Shorter', 'More detail in closure', 'Tone down assumptions'"></textarea>
          <div class="button-row">
            <button id="improveSxSoapBtn" type="button" class="secondary-btn">Refine Surgery SOAP</button>
          </div>
        </section>
      </div>
    </section>

    <!-- TOOLBOX TAB -->
    <section id="toolboxTab" class="tab-panel hidden">
      <div class="card">
        <h2>Toolbox Lite</h2>
        <p class="hint-text">
          Quick transforms: bloodwork summaries, client emails, weight consults, and free-form helper.
        </p>

        <div class="upload-row">
          <div>
            <label class="field-label">Attachments (optional)</label>
            <input id="toolboxFiles" type="file" multiple />
            <p class="hint-text small">
              Attach multiple lab screenshots / UA photos. Vision will try to read and include them in the summary.
            </p>
          </div>
          <button class="secondary-btn" type="button" data-privacy-target="toolboxFiles">
            ‚úèÔ∏è Privacy / Redact
          </button>
        </div>

        <div class="grid-2">
          <div>
            <label class="field-label" for="toolboxMode">Tool</label>
            <select id="toolboxMode">
              <option value="bloodwork-summary">Bloodwork summary</option>
              <option value="lab-interpretation">Lab interpretation (slightly longer)</option>
              <option value="client-email">Client email helper</option>
              <option value="weight-consult">Weight consult / maintenance handout</option>
              <option value="free-form">Free-form helper</option>
            </select>
          </div>
          <div>
            <label class="field-label" for="toolboxNotes">Notes / instructions</label>
            <input id="toolboxNotes" type="text" placeholder="e.g. 'Short, 2‚Äì3 sentences', 'Very detailed', 'Friendly tone'">
          </div>
        </div>

        <div>
          <label class="field-label" for="toolboxInput">Paste text here</label>
          <textarea id="toolboxInput" rows="7" placeholder="Paste CBC/chem, urinalysis, or any text you want transformed. Vision will also use attached images if present."></textarea>
        </div>

        <div class="button-row">
          <button id="runToolboxBtn" type="button" class="primary-btn">
            üß∞ Run Toolbox
          </button>
        </div>

        <section class="output-section">
          <div class="output-header">
            <h3>Toolbox output</h3>
            <div class="output-actions">
              <button id="copyToolboxOutputBtn" type="button" class="secondary-btn small">Copy output</button>
            </div>
          </div>
          <textarea id="toolboxOutput" class="soap-output" rows="14" placeholder="Toolbox result will appear here..."></textarea>
        </section>

        <section class="feedback-section">
          <label class="field-label" for="toolboxFeedbackInput">Refine / tweak this output</label>
          <textarea id="toolboxFeedbackInput" class="feedback-box" rows="3" placeholder="e.g. 'More formal', 'Shorter', 'Add lay explanation of kidney values'"></textarea>
          <div class="button-row">
            <button id="refineToolboxBtn" type="button" class="secondary-btn">Refine Toolbox output</button>
          </div>
        </section>
      </div>
    </section>

    <!-- CONSULT TAB -->
    <section id="consultTab" class="tab-panel hidden">
      <div class="card">
        <h2>Consult (Vet-to-Vet)</h2>
        <p class="hint-text">
          Quick, practical consult. Attach rads/labs screens if you want; text is primary.
        </p>

        <div class="upload-row">
          <div>
            <label class="field-label">Attachments (optional)</label>
            <input id="consultFiles" type="file" multiple />
            <p class="hint-text small">
              You can attach multiple rads or lab report screenshots. Vision will try to read any clear text / labels.
            </p>
          </div>
          <button class="secondary-btn" type="button" data-privacy-target="consultFiles">
            ‚úèÔ∏è Privacy / Redact
          </button>
        </div>

        <div>
          <label class="field-label" for="consultQuestion">Clinical question</label>
          <textarea id="consultQuestion" rows="7" placeholder="Signalment, problem list, key findings, and what you want help with."></textarea>
        </div>

        <div class="button-row">
          <button id="runConsultBtn" type="button" class="primary-btn">
            üí¨ Ask consult
          </button>
        </div>

        <section class="output-section">
          <div class="output-header">
            <h3>Consult answer</h3>
            <div class="output-actions">
              <button id="copyConsultOutputBtn" type="button" class="secondary-btn small">
                Copy answer
              </button>
            </div>
          </div>
          <textarea id="consultOutput" class="soap-output" rows="14" placeholder="Consult answer will appear here..."></textarea>
        </section>

        <section class="feedback-section">
          <label class="field-label" for="consultFeedbackInput">Refine / adjust consult</label>
          <textarea id="consultFeedbackInput" class="feedback-box" rows="3" placeholder="e.g. 'Shorter', 'More step-wise plan', 'More client-friendly language'"></textarea>
          <div class="button-row">
            <button id="refineConsultBtn" type="button" class="secondary-btn">Refine consult answer</button>
          </div>
        </section>
      </div>
    </section>

    <!-- TRANSFER TAB -->
    <section id="transferTab" class="tab-panel hidden">
      <div class="card">
        <h2>Phone ‚Üí Desktop (Transfer stub)</h2>
        <p class="hint-text">
          This is a safe stub so you have a place to land the future QR / Plaud / phone-to-desktop flow.
        </p>
        <p class="hint-text small">
          For now, you can paste text from your phone below and copy it into other tabs.
        </p>

        <div class="grid-2">
          <div>
            <label class="field-label" for="transferFromPhone">Paste from phone</label>
            <textarea id="transferFromPhone" rows="8" placeholder="Paste here from email, Notes, or Plaud transcript."></textarea>
          </div>
          <div>
            <label class="field-label" for="transferScratch">Scratchpad</label>
            <textarea id="transferScratch" rows="8" placeholder="Use as a holding tank, then copy into Appointment / Surgery / Toolbox."></textarea>
          </div>
        </div>

        <div class="button-row">
          <button id="copyTransferFromPhoneBtn" type="button" class="secondary-btn">
            Copy ‚Äúfrom phone‚Äù text
          </button>
          <button id="copyTransferScratchBtn" type="button" class="secondary-btn">
            Copy scratchpad
          </button>
        </div>

        <p class="hint-text small">
          The backend relay function is a simple echo stub at
          <code>/.netlify/functions/relay</code>. We can later turn that into a QR / shared-case system.
        </p>
      </div>
    </section>
  </section>

  <!-- RIGHT COLUMN: CONSOLE -->
  <aside class="main-right">
    <div class="card console-card">
      <h2>Activity log</h2>
      <textarea id="consoleOutput" class="console-output" readonly></textarea>
    </div>
  </aside>
</main>

<!-- PRIVACY MODAL -->
<div id="privacyModal" class="modal hidden" aria-hidden="true">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <h3>Privacy / Redaction</h3>
    <p class="hint-text">
      This prototype <strong>does</strong> send images to OpenAI for Vision/OCR.
      Please only upload photos that you are comfortable sending to the cloud, and
      manually redact owner names, phone, address, microchip, and other identifiers first.
    </p>
    <p class="hint-text small">
      Target: <span id="privacyTargetLabel">Unknown</span>
    </p>
    <div class="button-row">
      <button id="closePrivacyModalBtn" type="button" class="primary-btn">
        Close
      </button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>