<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moksha SOAP App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-root">
    <!-- Top header card -->
    <header class="app-header card">
      <div class="header-left">
        <img src="moksha-soap-logo.png" alt="Moksha SOAP logo" class="app-logo" />
        <div class="header-text">
          <div class="app-title-main">Moksha SOAP</div>
          <div class="app-title-sub">
            Lohit SOAP App · SOAP · Toolbox · Consult · Phone ↔ Desktop
          </div>
        </div>
      </div>
      <div class="header-right">
        <div class="status-pill">
          <span class="status-dot" id="backend-status-light"></span>
          <span>Backend reachable</span>
        </div>
        <div class="version-pill">v1.7.6 · Hybrid UI + Recorder</div>
      </div>
    </header>

    <!-- Top tabs -->
    <nav class="top-tabs">
      <button id="tab-soap" class="tab-button active">SOAP</button>
      <button id="tab-toolbox" class="tab-button">Toolbox</button>
      <button id="tab-consult" class="tab-button">Consult</button>
    </nav>

    <!-- Panels wrapper -->
    <main class="panels-wrapper">
      <!-- ===================== -->
      <!-- SOAP PANEL            -->
      <!-- ===================== -->
      <section id="panel-soap" class="panel panel-visible">
        <div class="layout-main">
          <!-- LEFT: SOAP INPUT -->
          <section class="column column-left">
            <div class="card">
              <div class="card-header-row">
                <h2 class="card-title">SOAP INPUT</h2>
                <div class="card-subtitle">Appointment · Surgery · Voice</div>
              </div>

              <!-- Appointment vs Surgery toggle -->
              <div class="pill-toggle-group">
                <button id="visit-appointment" class="pill-button active">
                  Appointment
                </button>
                <button id="visit-surgery" class="pill-button">
                  Surgery
                </button>
              </div>

              <!-- Surgery mode row: Simple vs Advanced (hidden in Appointment mode) -->
              <div id="surgery-mode-row" class="pill-toggle-group surgery-mode-row">
                <button id="surgery-simple" class="pill-button active">
                  Simple
                </button>
                <button id="surgery-advanced" class="pill-button">
                  Advanced
                </button>
                <span class="hint-text">
                  Simple = quick notes · Advanced = full anesthesia details
                </span>
              </div>

              <!-- Common fields (for both appointment & surgery) -->
              <div class="field-grid">
                <div class="field">
                  <label for="case-label">Case label</label>
                  <input id="case-label" type="text" placeholder="e.g. Bella – Spay recheck" />
                </div>
                <div class="field">
                  <label for="patient-name">Patient name</label>
                  <input id="patient-name" type="text" placeholder="e.g. Bella" />
                </div>

                <div class="field">
                  <label for="weight-kg">Weight (kg)</label>
                  <input id="weight-kg" type="text" placeholder="e.g. 6.4" />
                </div>
                <div class="field">
                  <label for="species">Species</label>
                  <select id="species">
                    <option value="">Select species</option>
                    <option>Canine</option>
                    <option>Feline</option>
                    <option>Other</option>
                  </select>
                </div>

                <div class="field">
                  <label for="sex">Sex</label>
                  <select id="sex">
                    <option value="">Sex</option>
                    <option>Male</option>
                    <option>Male neutered</option>
                    <option>Female</option>
                    <option>Female spayed</option>
                  </select>
                </div>
                <div class="field">
                  <label for="asa">ASA (surgery)</label>
                  <select id="asa">
                    <option value="">Select ASA</option>
                    <option>I</option>
                    <option>II</option>
                    <option>III</option>
                    <option>IV</option>
                  </select>
                </div>

                <div class="field full-width">
                  <label for="tpr-notes">TPR / notes</label>
                  <input
                    id="tpr-notes"
                    type="text"
                    placeholder="TPR, BCS, key vitals / comments"
                  />
                </div>
              </div>

              <!-- Appointment-only fields -->
              <div id="appointment-fields">
                <div class="field">
                  <label for="appointment-preset">Appointment preset</label>
                  <select id="appointment-preset">
                    <option value="">Custom / blank</option>
                    <option>Wellness / vaccines</option>
                    <option>GI upset</option>
                    <option>Derm / otitis</option>
                    <option>Cough / URI</option>
                    <option>Lameness</option>
                    <option>Wellness senior</option>
                  </select>
                </div>

                <div class="checkbox-row">
                  <label>
                    <input type="checkbox" id="vaccines-today" />
                    <span>Vaccines done today</span>
                  </label>
                  <span class="hint-text">
                    Used to auto-open vaccine SOAP style for wellness exams.
                  </span>
                </div>
              </div>

              <!-- Surgery-only fields -->
              <div id="surgery-fields">
                <div class="field">
                  <label for="surgery-preset">Surgery preset</label>
                  <select id="surgery-preset">
                    <option value="custom">Custom surgery</option>
                    <option>Canine spay</option>
                    <option>Canine neuter</option>
                    <option>Feline spay</option>
                    <option>Feline neuter</option>
                    <option>Dental – COHAT with rads</option>
                    <option>Dental – COHAT (no rads)</option>
                    <option>Mass removal</option>
                    <option>Cystotomy</option>
                    <option>Pyometra spay</option>
                    <option>Exploratory laparotomy</option>
                    <option>Enterotomy</option>
                    <option>Gastrotomy</option>
                    <option>Gastropexy</option>
                    <option>Feline urethral unblock</option>
                  </select>
                </div>

                <!-- SIMPLE surgery fields -->
                <div id="surgery-simple-fields">
                  <div class="field">
                    <label for="simple-fluids">Fluids (brief)</label>
                    <input
                      id="simple-fluids"
                      type="text"
                      placeholder="e.g. LRS 5 mL/kg/hr"
                    />
                  </div>
                  <div class="field">
                    <label for="simple-premed">Premed (brief)</label>
                    <input
                      id="simple-premed"
                      type="text"
                      placeholder="e.g. Methadone + Dex (standard dose)"
                    />
                  </div>
                  <div class="field">
                    <label for="simple-induction">Induction / maintenance (brief)</label>
                    <input
                      id="simple-induction"
                      type="text"
                      placeholder="e.g. Propofol to effect, Iso / O₂"
                    />
                  </div>
                </div>

                <!-- ADVANCED surgery fields -->
                <div id="surgery-advanced-fields">
                  <div class="field-grid">
                    <div class="field">
                      <label for="ett-size">ET tube size</label>
                      <input
                        id="ett-size"
                        type="text"
                        placeholder="e.g. 9.0 mm cuffed"
                      />
                    </div>
                    <div class="field">
                      <label for="iv-cath">IV catheter</label>
                      <input
                        id="iv-cath"
                        type="text"
                        placeholder="e.g. 22G cephalic, L"
                      />
                    </div>
                  </div>

                  <div class="field">
                    <label for="adv-fluids">Fluids</label>
                    <input
                      id="adv-fluids"
                      type="text"
                      placeholder="e.g. LRS 5 mL/kg/hr (dogs), 3 mL/kg/hr (cats)"
                    />
                  </div>

                  <div class="field">
                    <label for="adv-premed">Premed protocol</label>
                    <input
                      id="adv-premed"
                      type="text"
                      placeholder="e.g. Methadone + Dex (mg/kg auto in SOAP)"
                    />
                  </div>

                  <div class="field">
                    <label for="adv-induction">Induction</label>
                    <input
                      id="adv-induction"
                      type="text"
                      placeholder="e.g. Propofol to effect"
                    />
                  </div>

                  <div class="field">
                    <label for="adv-maint">Maintenance</label>
                    <input
                      id="adv-maint"
                      type="text"
                      placeholder="e.g. Isoflurane / O₂, standard monitoring"
                    />
                  </div>

                  <div class="field">
                    <label for="adv-intraop">Intra-op meds</label>
                    <input
                      id="adv-intraop"
                      type="text"
                      placeholder="e.g. Fentanyl CRI, Lidocaine infusion, NSAID"
                    />
                  </div>

                  <div class="field">
                    <label for="adv-postop">Post-op / take-home meds</label>
                    <input
                      id="adv-postop"
                      type="text"
                      placeholder="e.g. Bup SR, NSAID, trazodone"
                    />
                  </div>
                </div>
              </div>

              <!-- Common text areas -->
              <div class="field full-width">
                <label for="core-notes">Core notes / history</label>
                <textarea
                  id="core-notes"
                  rows="3"
                  placeholder="Why are they here today? Pertinent history, owner concerns, context."
                ></textarea>
              </div>

              <div class="field full-width">
                <label for="pe-data">PE & diagnostics (data only)</label>
                <textarea
                  id="pe-data"
                  rows="3"
                  placeholder="Include PE systems list, diagnostic results, vitals – values only, no interpretation."
                ></textarea>
              </div>

              <div class="field full-width">
                <label for="assessment-hints">Assessment hints</label>
                <textarea
                  id="assessment-hints"
                  rows="3"
                  placeholder="What are you worried about? Rule-outs, problem list, ASA grade for anesthesia cases."
                ></textarea>
              </div>

              <div class="field full-width">
                <label for="plan-hints">Plan & discharge hints</label>
                <textarea
                  id="plan-hints"
                  rows="3"
                  placeholder="Diagnostics, treatments, procedures, recheck timing, what you told the owner, activity restrictions."
                ></textarea>
              </div>

              <div class="field full-width">
                <label for="extra-notes">Extra instructions / anything else</label>
                <textarea
                  id="extra-notes"
                  rows="3"
                  placeholder="Edge cases, special instructions, inventory notes, anything weird or important."
                ></textarea>
              </div>

              <details class="accordion">
                <summary>External transcript (optional – paste Covet transcript or call log)</summary>
                <textarea id="external-transcript" rows="3"></textarea>
              </details>

              <details class="accordion">
                <summary>Voice notes (optional – paste transcript)</summary>
                <textarea id="voice-notes" rows="3"></textarea>
              </details>

              <button id="generate-soap-btn" class="primary-btn">
                Generate SOAP
              </button>
            </div>
          </section>

          <!-- RIGHT: OUTPUT + RELAY -->
          <section class="column column-right">
            <div class="card">
              <div class="card-header-row">
                <h2 class="card-title">OUTPUT · AI BRAIN – SOAP</h2>
                <div class="card-subtitle right">
                  <span class="status-dot small green"></span>
                  <span>Ready</span>
                </div>
              </div>

              <div id="soap-output-box" class="output-box">
                SOAP / Toolbox / Consult output will appear here.
              </div>

              <div class="button-row">
                <button class="secondary-btn">Copy full SOAP / output</button>
                <button class="secondary-btn">Copy Plan + Meds + Aftercare</button>
              </div>
              <button class="secondary-btn wide">Send output to desktop</button>
            </div>

            <!-- Feedback / brain tuning section -->
            <div class="card">
              <div class="card-header-row">
                <h3 class="card-title small">Feedback to Moksha SOAP</h3>
                <div class="pill-label">Brain tuning (local only)</div>
              </div>
              <textarea
                id="feedback-text"
                rows="3"
                placeholder="What would you change in this output? Missing details, tone, formatting, etc."
              ></textarea>
              <button class="secondary-btn wide">Apply feedback &amp; refine</button>
            </div>

            <!-- Phone ↔ Desktop relay / uploads (UI only; your JS can hook in) -->
            <div class="card">
              <div class="card-header-row">
                <h3 class="card-title small">Phone ↔ Desktop relay · Uploads</h3>
                <div class="pill-label">Clinic-only</div>
              </div>

              <div class="field">
                <label for="relay-id">Relay ID</label>
                <div class="relay-row">
                  <input id="relay-id" type="text" value="auto" readonly />
                  <button class="secondary-btn small">New</button>
                </div>
              </div>

              <div class="button-column">
                <button class="secondary-btn wide">Receive text from phone</button>
                <button class="secondary-btn wide">Receive files from phone</button>

                <label class="upload-btn wide">
                  <input type="file" multiple hidden />
                  <span>Upload from this device</span>
                </label>
              </div>

              <p class="hint-text tiny">
                No files uploaded yet. Use Send output to desktop from your phone, then Receive text here.
              </p>
            </div>
          </section>
        </div>
      </section>

      <!-- ===================== -->
      <!-- TOOLBOX PANEL         -->
      <!-- ===================== -->
      <section id="panel-toolbox" class="panel">
        <div class="card">
          <div class="card-header-row">
            <h2 class="card-title">Toolbox Lite</h2>
            <div class="card-subtitle">
              Quick helpers – bloodwork, client emails, small docs
            </div>
          </div>
          <div class="field full-width">
            <label for="toolbox-input">Paste text or notes</label>
            <textarea
              id="toolbox-input"
              rows="6"
              placeholder="e.g. Paste bloodwork, write ‘short summary + client-friendly explanation’"
            ></textarea>
          </div>
          <button class="primary-btn">Run Toolbox</button>

          <div class="field full-width">
            <label for="toolbox-output">Toolbox output</label>
            <textarea id="toolbox-output" rows="8"></textarea>
          </div>
        </div>
      </section>

      <!-- ===================== -->
      <!-- CONSULT PANEL         -->
      <!-- ===================== -->
      <section id="panel-consult" class="panel">
        <div class="card">
          <div class="card-header-row">
            <h2 class="card-title">Consult</h2>
            <div class="card-subtitle">
              Free-form mode – ask Moksha SOAP for anything
            </div>
          </div>
          <div class="field full-width">
            <label for="consult-notes">Consult question / context</label>
            <textarea
              id="consult-notes"
              rows="6"
              placeholder="e.g. Draft an email, summarize this case, help with client handout…"
            ></textarea>
          </div>
          <button class="primary-btn">Run Consult</button>

          <div class="field full-width">
            <label for="consult-output">Consult output</label>
            <textarea id="consult-output" rows="8"></textarea>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script defer src="app.js"></script>
</body>
</html>