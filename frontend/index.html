<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moksha SOAP ¬∑ Lohit SOAP App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-shell">
    <!-- HEADER / STATUS -->
    <header class="header-card">
      <div class="header-left">
        <div class="logo-row">
          <img src="moksha-soap-logo.png" alt="Moksha SOAP logo" class="logo-img" />
          <div class="logo-text">
            <div class="app-title">Moksha SOAP</div>
            <div class="app-subtitle">
              Lohit SOAP App ¬∑ SOAP ¬∑ Toolbox ¬∑ Consult ¬∑ Phone ‚Üî Desktop
            </div>
          </div>
        </div>
      </div>

      <div class="header-right">
        <div class="status-pill">
          <span id="backend-status-dot" class="status-dot status-dot-gray"></span>
          <span id="backend-status-label">Backend checking‚Ä¶</span>
        </div>
        <div class="version-pill">
          v1.7.6 ¬∑ Hybrid UI + Recorder
        </div>
        <button id="record-btn" type="button" class="record-btn">
          üé§ Recorder
        </button>
      </div>
    </header>

    <!-- MAIN TABS -->
    <nav class="main-tabs">
      <button id="tab-soap" class="tab-button tab-active">SOAP</button>
      <button id="tab-toolbox" class="tab-button">Toolbox</button>
      <button id="tab-consult" class="tab-button">Consult</button>
    </nav>

    <!-- PANELS WRAPPER -->
    <main class="panels-wrapper">
      <!-- SOAP PANEL -->
      <section id="panel-soap" class="panel panel-active">
        <div class="panel-body">
          <!-- SOAP INPUT CARD -->
          <section class="card">
            <header class="card-header">
              <div class="card-title">SOAP Input</div>
              <div class="card-subtitle" id="soap-mode-label">
                Appointment ¬∑ Surgery ¬∑ Voice
              </div>
            </header>

            <form id="soap-form" class="card-body-content">
              <!-- Top toggles -->
              <div class="toggle-row">
                <div class="toggle-group">
                  <span class="toggle-label">Visit type</span>
                  <div class="pill-toggle">
                    <button type="button" id="visit-appointment" class="pill pill-active">
                      Appointment
                    </button>
                    <button type="button" id="visit-surgery" class="pill">
                      Surgery
                    </button>
                  </div>
                </div>

                <div class="toggle-group">
                  <span class="toggle-label">Surgery mode</span>
                  <div class="pill-toggle">
                    <button type="button" id="mode-simple" class="pill pill-active">
                      Simple
                    </button>
                    <button type="button" id="mode-advanced" class="pill">
                      Advanced
                    </button>
                  </div>
                  <div class="toggle-help">
                    Simple = quick notes ¬∑ Advanced = full anesthesia details
                  </div>
                </div>
              </div>

              <!-- Core demographics -->
              <div class="grid grid-2">
                <div class="field">
                  <label for="caseLabel">Case label</label>
                  <input id="caseLabel" type="text" placeholder="e.g. Bella ‚Äì Spay recheck" />
                </div>
                <div class="field">
                  <label for="patientName">Patient name</label>
                  <input id="patientName" type="text" placeholder="e.g. Bella" />
                </div>
              </div>

              <div class="grid grid-3">
                <div class="field">
                  <label for="weightKg">Weight (kg)</label>
                  <input id="weightKg" type="number" step="0.1" placeholder="e.g. 6.4" />
                </div>
                <div class="field">
                  <label for="species">Species</label>
                  <select id="species">
                    <option value="">Select species</option>
                    <option value="canine">Dog</option>
                    <option value="feline">Cat</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="field">
                  <label for="sex">Sex</label>
                  <select id="sex">
                    <option value="">Sex</option>
                    <option value="mi">MI</option>
                    <option value="mc">MC</option>
                    <option value="fi">FI</option>
                    <option value="fs">FS</option>
                  </select>
                </div>
              </div>

              <div class="grid grid-3">
                <div class="field visit-surgery-only">
                  <label for="asa">ASA (surgery)</label>
                  <select id="asa">
                    <option value="">Select ASA</option>
                    <option value="I">ASA I</option>
                    <option value="II">ASA II</option>
                    <option value="III">ASA III</option>
                    <option value="IV">ASA IV</option>
                  </select>
                </div>
                <div class="field">
                  <label for="tprNotes">TPR / notes</label>
                  <input id="tprNotes" type="text" placeholder="TPR, BCS, key vitals / comments" />
                </div>
                <div class="field visit-appointment-only">
                  <label for="appointmentPreset">Appointment preset</label>
                  <select id="appointmentPreset">
                    <option value="custom">Custom / blank</option>
                    <option value="wellness">Wellness / vaccines</option>
                    <option value="gi">GI upset</option>
                    <option value="derm">Derm / otitis</option>
                    <option value="cough">Cough / URI</option>
                    <option value="lameness">Lameness</option>
                    <option value="wellness-senior">Senior wellness</option>
                    <option value="weight">Weight consult / weight loss</option>
                  </select>
                </div>
              </div>

              <div class="grid grid-2">
                <div class="field visit-surgery-only">
                  <label for="surgeryPreset">Surgery preset</label>
                  <select id="surgeryPreset">
                    <option value="custom">Custom surgery</option>
                    <option value="canine-spay">Canine spay</option>
                    <option value="canine-neuter">Canine neuter</option>
                    <option value="feline-spay">Feline spay</option>
                    <option value="feline-neuter">Feline neuter</option>
                    <option value="dental-rads">Dental ‚Äì COHAT with rads</option>
                    <option value="dental-no-rads">Dental ‚Äì COHAT (no rads)</option>
                    <option value="mass-removal">Mass removal</option>
                    <option value="cystotomy">Cystotomy</option>
                    <option value="pyometra-spay">Pyometra spay</option>
                    <option value="exploratory">Exploratory laparotomy</option>
                    <option value="enterotomy">Enterotomy</option>
                    <option value="gastrotomy">Gastrotomy</option>
                    <option value="gastropexy">Gastropexy</option>
                    <option value="feline-unblock">Feline urethral unblock</option>
                  </select>
                </div>

                <div class="field">
                  <label class="checkbox-label">
                    <input id="vaccinesToday" type="checkbox" />
                    <span>Vaccines done today</span>
                  </label>
                  <div class="hint">
                    Used to auto-open vaccine SOAP style for wellness exams.
                  </div>
                </div>
              </div>

              <!-- Simple surgery brief fields -->
              <div id="surgery-brief-section" class="visit-surgery-only simple-only">
                <div class="section-label">Surgery snapshot (simple)</div>
                <div class="grid grid-3">
                  <div class="field">
                    <label for="briefFluids">Fluids (brief)</label>
                    <input id="briefFluids" type="text" placeholder="e.g. LRS 5 mL/kg/hr" />
                  </div>
                  <div class="field">
                    <label for="briefPremed">Premed (brief)</label>
                    <input id="briefPremed" type="text" placeholder="e.g. Methadone + Dex" />
                  </div>
                  <div class="field">
                    <label for="briefInduction">Induction / maintenance (brief)</label>
                    <input id="briefInduction" type="text" placeholder="e.g. Propofol, Iso / O‚ÇÇ" />
                  </div>
                </div>
              </div>

              <!-- Advanced anesthesia block -->
              <div id="surgery-advanced-section" class="visit-surgery-only advanced-only hidden">
                <div class="section-label">Anesthesia details (advanced)</div>
                <div class="grid grid-3">
                  <div class="field">
                    <label for="ettSize">ET tube</label>
                    <input id="ettSize" type="text" placeholder="e.g. 9.0 mm cuffed" />
                  </div>
                  <div class="field">
                    <label for="ivCatheter">IV catheter</label>
                    <input id="ivCatheter" type="text" placeholder="e.g. 22g cephalic, L" />
                  </div>
                  <div class="field">
                    <label for="advFluids">Fluids</label>
                    <input id="advFluids" type="text" placeholder="e.g. LRS 5 mL/kg/hr (dogs)" />
                  </div>
                </div>

                <div class="grid grid-2">
                  <div class="field">
                    <label for="premedProtocol">Premed protocol</label>
                    <input id="premedProtocol" type="text"
                      placeholder="e.g. Methadone + Dex (mg/kg auto in SOAP)" />
                  </div>
                  <div class="field">
                    <label for="inductionProtocol">Induction</label>
                    <input id="inductionProtocol" type="text" placeholder="e.g. Propofol to effect" />
                  </div>
                </div>

                <div class="grid grid-3">
                  <div class="field">
                    <label for="maintenanceProtocol">Maintenance</label>
                    <input id="maintenanceProtocol" type="text"
                      placeholder="e.g. Isoflurane / O‚ÇÇ, standard monitoring" />
                  </div>
                  <div class="field">
                    <label for="intraOpMeds">Intra-op meds</label>
                    <input id="intraOpMeds" type="text"
                      placeholder="e.g. Fentanyl CRI, Lidocaine infusion, NSAID" />
                  </div>
                  <div class="field">
                    <label for="postOpMeds">Post-op / take-home meds</label>
                    <input id="postOpMeds" type="text"
                      placeholder="e.g. Bup SR, NSAID, trazodone" />
                  </div>
                </div>
              </div>

              <!-- Narrative fields -->
              <div class="field">
                <label for="coreHistory">Core notes / history</label>
                <textarea id="coreHistory" rows="3" data-allow-recording="true"
                  placeholder="Why are they here today? Pertinent history, owner concerns, context."></textarea>
              </div>

              <div class="field">
                <label for="peDiagnostics">PE & diagnostics (data only)</label>
                <textarea id="peDiagnostics" rows="3"
                  placeholder="Include PE systems list, diagnostic results, vitals ‚Äì values only, no interpretation."
                  data-allow-recording="true"></textarea>
              </div>

              <div class="field">
                <label for="assessmentHints">Assessment hints</label>
                <textarea id="assessmentHints" rows="2"
                  placeholder="What are you worried about? Rule-outs, problem list, ASA grade for anesthesia cases."
                  data-allow-recording="true"></textarea>
              </div>

              <div class="field">
                <label for="planHints">Plan & discharge hints</label>
                <textarea id="planHints" rows="2"
                  placeholder="Diagnostics, treatments, procedures, recheck timing, what you told the owner, activity restrictions."
                  data-allow-recording="true"></textarea>
              </div>

              <div class="field">
                <label for="extraInstructions">Extra instructions / anything else</label>
                <textarea id="extraInstructions" rows="2"
                  placeholder="Edge cases, special instructions, inventory notes, anything weird or important."
                  data-allow-recording="true"></textarea>
              </div>

              <details class="details-field">
                <summary>Voice notes (optional ‚Äì paste transcript)</summary>
                <textarea id="voiceNotes" rows="2" data-allow-recording="true"
                  placeholder="Recorder will append here when this box is focused."></textarea>
              </details>

              <button id="soap-generate" type="submit" class="primary-button">
                Generate SOAP
              </button>
            </form>
          </section>

          <!-- SOAP OUTPUT + RELAY + FEEDBACK -->
          <section class="card output-card">
            <header class="card-header">
              <div class="card-title">Output ¬∑ AI Brain ‚Äì SOAP</div>
              <div class="status-pill small-pill">
                <span id="soap-output-status-dot" class="status-dot status-dot-green"></span>
                <span id="soap-output-status-label">Ready</span>
              </div>
            </header>

            <div class="card-body-content">
              <textarea id="soap-output" class="output-area" rows="16"
                placeholder="SOAP / Toolbox / Consult output will appear here." readonly></textarea>

              <div class="button-row">
                <button id="copy-soap-full" type="button" class="secondary-button">
                  Copy full SOAP / output
                </button>
                <button id="copy-plan-meds" type="button" class="secondary-button">
                  Copy Plan + Meds + Aftercare
                </button>
                <button id="send-to-desktop" type="button" class="secondary-button">
                  Send output to desktop
                </button>
              </div>

              <!-- Feedback for SOAP -->
              <section class="feedback-section">
                <header class="feedback-header">
                  <span>Feedback to Moksha SOAP</span>
                  <span class="feedback-pill">Brain tuning (local only)</span>
                </header>
                <textarea id="soap-feedback" rows="2"
                  placeholder="What would you change in this output? Missing details, tone, formatting, etc."
                  data-allow-recording="true"></textarea>
                <button id="apply-soap-feedback" type="button" class="tertiary-button">
                  Apply feedback & refine
                </button>
              </section>

              <!-- Phone ‚Üî Desktop relay -->
              <section class="relay-section">
                <header class="relay-header">
                  <div>Phone ‚Üî Desktop relay ¬∑ Uploads</div>
                  <div class="relay-tag">Clinic-only</div>
                </header>

                <div class="relay-row">
                  <label class="relay-label" for="relayIdInput">Relay ID</label>
                  <input id="relayIdInput" type="text" placeholder="auto" />
                  <button id="relayNewIdBtn" type="button" class="small-button">
                    New
                  </button>
                </div>

                <div class="relay-buttons">
                  <button id="relayReceiveTextBtn" type="button" class="secondary-button small-wide">
                    Receive text from phone
                  </button>
                  <button id="relayReceiveFilesBtn" type="button" class="secondary-button small-wide" disabled>
                    Receive files from phone (coming soon)
                  </button>
                </div>

                <div class="upload-row">
                  <label for="uploadInput" class="upload-label secondary-button small-wide">
                    Upload from this device
                  </label>
                  <input id="uploadInput" type="file" multiple class="hidden" />
                  <div class="upload-hint">
                    No files uploaded yet. Use ‚ÄúSend output to desktop‚Äù from your phone, then ‚ÄúReceive text‚Äù here.
                  </div>
                </div>
              </section>
            </div>
          </section>
        </div>
      </section>

      <!-- TOOLBOX PANEL -->
      <section id="panel-toolbox" class="panel">
        <div class="panel-body">
          <section class="card">
            <header class="card-header">
              <div class="card-title">Toolbox Lite</div>
              <div class="card-subtitle">
                Quick helpers ‚Äì bloodwork, client emails, small docs
              </div>
            </header>

            <div class="card-body-content">
              <div class="field">
                <label for="toolboxInput">Paste text or notes</label>
                <textarea id="toolboxInput" rows="6" data-allow-recording="true"
                  placeholder="e.g. Paste bloodwork, write ‚Äòshort summary + client-friendly explanation‚Äô"></textarea>
              </div>

              <button id="runToolbox" type="button" class="primary-button">
                Run Toolbox
              </button>

              <div class="field">
                <label for="toolboxOutput">Toolbox output</label>
                <textarea id="toolboxOutput" rows="10" class="output-area" readonly></textarea>
              </div>

              <div class="button-row">
                <button id="copyToolboxOutput" type="button" class="secondary-button">
                  Copy Toolbox output
                </button>
              </div>

              <!-- Feedback for Toolbox -->
              <section class="feedback-section">
                <header class="feedback-header">
                  <span>Feedback to Moksha SOAP ¬∑ Toolbox</span>
                  <span class="feedback-pill">Brain tuning (local only)</span>
                </header>
                <textarea id="toolboxFeedback" rows="2"
                  placeholder="What would you change in this Toolbox result? Level of detail, tone, etc."
                  data-allow-recording="true"></textarea>
                <button id="applyToolboxFeedback" type="button" class="tertiary-button">
                  Refine Toolbox output
                </button>
              </section>
            </div>
          </section>
        </div>
      </section>

      <!-- CONSULT PANEL -->
      <section id="panel-consult" class="panel">
        <div class="panel-body">
          <section class="card">
            <header class="card-header">
              <div class="card-title">Consult</div>
              <div class="card-subtitle">
                Free-form mode ‚Äì ask Moksha SOAP for anything
              </div>
            </header>

            <div class="card-body-content">
              <div class="field">
                <label for="consultInput">Consult question / context</label>
                <textarea id="consultInput" rows="5"
                  placeholder="e.g. Draft an email, summarize this case, help with a client handout‚Ä¶"
                  data-allow-recording="true"></textarea>
              </div>

              <button id="runConsult" type="button" class="primary-button">
                Run Consult
              </button>

              <div class="field">
                <label for="consultOutput">Consult output</label>
                <textarea id="consultOutput" rows="10" class="output-area" readonly></textarea>
              </div>

              <div class="button-row">
                <button id="copyConsultOutput" type="button" class="secondary-button">
                  Copy Consult output
                </button>
              </div>

              <!-- Feedback for Consult -->
              <section class="feedback-section">
                <header class="feedback-header">
                  <span>Feedback to Moksha SOAP ¬∑ Consult</span>
                  <span class="feedback-pill">Brain tuning (local only)</span>
                </header>
                <textarea id="consultFeedback" rows="2"
                  placeholder="How should this consult answer change? Add/remove detail, adjust tone, etc."
                  data-allow-recording="true"></textarea>
                <button id="applyConsultFeedback" type="button" class="tertiary-button">
                  Refine Consult output
                </button>
              </section>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>