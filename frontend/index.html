<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moksha SOAP â€“ v1.8 (Stable)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
<div class="app-shell">

  <!-- ===========================
       HEADER WITH LOGO
  ============================ -->
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-title">
        <img src="moksha_logo.png" class="logo-img" />
        Moksha SOAP
      </div>
      <div class="app-subtitle">SOAP â€¢ Toolbox â€¢ Consult â€¢ Vision â€¢ Phone â†” Desktop</div>
    </div>

    <div class="app-header-right">
      <div class="pill">
        <span class="pill-dot" id="backendDot"></span>
        <span id="backendStatus">Backend reachable</span>
      </div>

      <div class="pill pill-version">v1.8 Stable</div>
    </div>
  </header>

  <!-- ===========================
       TOP TABS
  ============================ -->
  <div class="top-tabs">
    <button class="top-tab-btn active" data-tab="soap">
      ðŸ§¾ SOAP
    </button>
    <button class="top-tab-btn" data-tab="toolbox">
      ðŸ§° Toolbox
    </button>
    <button class="top-tab-btn" data-tab="consult">
      ðŸ’­ Consult
    </button>
  </div>

  <!-- ===========================
       GLOBAL UPLOAD BAR (Option A)
       Works for SOAP, Toolbox, Consult
  ============================ -->
  <div class="upload-bar">
    <label class="upload-btn">
      ðŸ“Ž Attach files (Vision enabled)
      <input type="file" id="fileUploadInput" multiple />
    </label>

    <div id="fileUploadList" class="file-list">
      No files uploaded yet.
    </div>
  </div>


  <!-- ===========================
       MAIN 2-COLUMN LAYOUT
  ============================ -->
  <div class="content-grid">


<!-- =====================================================================
     LEFT COLUMN â€” SOAP SECTION (Part 1 covers up to anesthesia header)
===================================================================== -->
<div id="soap-section" class="panel">

  <div class="panel-header">
    <div class="panel-title">SOAP â€“ Appointment / Surgery</div>
    <div class="panel-chip">Voice â€¢ Vision â€¢ Presets</div>
  </div>

  <div class="panel-body">

    <!-- Basic patient info -->
    <div class="field-row">
      <div class="field">
        <label class="field-label">Case label</label>
        <input type="text" id="caseLabel" placeholder="Bella â€“ Spay recheck" />
      </div>

      <div class="field">
        <label class="field-label">Patient name</label>
        <input type="text" id="patientName" placeholder="Bella" />
      </div>
    </div>

    <div class="field-row">
      <div class="field">
        <label class="field-label">Species</label>
        <select id="species">
          <option value="">Select species</option>
          <option value="canine">Canine</option>
          <option value="feline">Feline</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="field">
        <label class="field-label">Sex</label>
        <select id="sex">
          <option value="">Sex</option>
          <option value="M">Male</option>
          <option value="MN">Male Neutered</option>
          <option value="F">Female</option>
          <option value="FS">Female Spayed</option>
        </select>
      </div>

      <div class="field">
        <label class="field-label">Weight (kg)</label>
        <input type="number" step="0.1" id="weightKg" placeholder="6.4" />
      </div>
    </div>

    <!-- Visit type toggle -->
    <div class="field-row">
      <div class="field">
        <label class="field-label">Visit type</label>
        <div class="chip-toggle-group">
          <button class="chip-toggle active" id="visitTypeAppointment">Appointment</button>
          <button class="chip-toggle" id="visitTypeSurgery">Surgery</button>
        </div>
      </div>

      <div class="field" id="asaField" style="display:none;">
        <label class="field-label">ASA</label>
        <select id="asaStatus">
          <option value="">Select ASA</option>
          <option value="I">I</option>
          <option value="II">II</option>
          <option value="III">III</option>
          <option value="IV">IV</option>
        </select>
      </div>
    </div>

    <!-- Appointment preset row -->
    <div class="field-row" id="appointmentPresetRow">
      <div class="field">
        <label class="field-label">Appointment preset</label>
        <select id="appointmentPreset">
          <option value="">Custom</option>
          <option value="wellness">Wellness</option>
          <option value="gi">GI upset</option>
          <option value="derm">Dermatitis / Otitis</option>
          <option value="cough">Cough / URI</option>
          <option value="lameness">Lameness</option>
          <option value="senior">Senior multi-issue</option>
          <option value="recheck">Recheck</option>
        </select>
      </div>
    </div>

    <!-- Surgery preset row -->
    <div class="field-row" id="surgeryPresetRow" style="display:none;">
      <div class="field">
        <label class="field-label">Surgery preset</label>
        <select id="surgeryPreset">
          <option value="">Custom</option>
          <option value="dog_spay">Canine Spay</option>
          <option value="dog_neuter">Canine Neuter</option>
          <option value="cat_spay">Feline Spay</option>
          <option value="cat_neuter">Feline Neuter</option>
          <option value="pyometra">Pyometra</option>
          <option value="cystotomy">Cystotomy</option>
          <option value="exploratory">Exploratory</option>
          <option value="enterotomy">Enterotomy</option>
          <option value="mass_removal">Mass Removal</option>
          <option value="laceration">Laceration Repair</option>
          <option value="amputation">Amputation</option>
          <option value="dental_no_rads">Dental COHAT â€“ No Rads</option>
        </select>
      </div>

      <div class="field">
        <label class="field-label">Surgery mode</label>
        <div class="chip-toggle-group">
          <button class="chip-toggle active" id="surgeryModeSimple">Simple</button>
          <button class="chip-toggle" id="surgeryModeAdvanced">Advanced</button>
        </div>
      </div>
    </div>

    <!-- ==== START: Anesthesia (Hybrid UI placeholder, real controls appear in Part 2) ==== -->
    <div id="anesthesiaBlock">
      <!-- More will load in Part 2 -->      <!-- ==== ANESTHESIA BLOCK (Hybrid UI) ==== -->
      <div class="panel-subtitle">Anesthesia</div>

      <!-- SIMPLE MODE: One dropdown -->
      <div id="anesthesiaSimpleRow" class="field-row">
        <div class="field">
          <label class="field-label">Premed cocktail</label>
          <select id="premedSimple">
            <option value="">Select...</option>
            <optgroup label="TDK (Cats)">
              <option value="tdk_im">TDK IM (1:1:1:1)</option>
              <option value="tdk_iv">TDK IV (1:1:1:1)</option>
            </optgroup>

            <optgroup label="Methadone-based">
              <option value="methadone_midaz_im">Methadone + Midazolam IM</option>
              <option value="methadone_midaz_iv">Methadone + Midazolam IV</option>
              <option value="methadone_dex_im">Methadone + Dexmedetomidine IM</option>
              <option value="methadone_dex_iv">Methadone + Dexmedetomidine IV</option>
              <option value="methadone_im">Methadone IM</option>
              <option value="methadone_iv">Methadone IV</option>
            </optgroup>

            <optgroup label="Hydromorphone-based">
              <option value="hydro_midaz_im">Hydromorphone + Midazolam IM</option>
              <option value="hydro_midaz_iv">Hydromorphone + Midazolam IV</option>
              <option value="hydro_dex_im">Hydromorphone + Dexmedetomidine IM</option>
              <option value="hydro_dex_iv">Hydromorphone + Dexmedetomidine IV</option>
              <option value="hydromorphone_im">Hydromorphone IM</option>
              <option value="hydromorphone_iv">Hydromorphone IV</option>
            </optgroup>

            <optgroup label="Butorphanol-based">
              <option value="torb_midaz_im">Torb + Midazolam IM</option>
              <option value="torb_midaz_iv">Torb + Midazolam IV</option>
              <option value="torb_ket_midaz_im">Torb + Ketamine + Midaz IM</option>
              <option value="torb_ket_midaz_iv">Torb + Ketamine + Midaz IV</option>
            </optgroup>

            <optgroup label="Buprenorphine-based">
              <option value="bup_midaz_im">Buprenorphine + Midazolam IM</option>
              <option value="bup_midaz_iv">Buprenorphine + Midazolam IV</option>
              <option value="bup_dex_im">Buprenorphine + Dexmedetomidine IM</option>
              <option value="bup_dex_iv">Buprenorphine + Dexmedetomidine IV</option>
              <option value="bup_im">Buprenorphine IM</option>
              <option value="bup_iv">Buprenorphine IV</option>
              <option value="bup_sr">Buprenorphine SR (IM only)</option>
            </optgroup>

          </select>
        </div>
      </div>

      <!-- ADVANCED MODE: Multi-select for full control -->
      <div id="anesthesiaAdvancedRow" class="field-row" style="display:none;">
        <div class="field">
          <label class="field-label">
            Detailed anesthesia components
            <span class="hint">(Ctrl/Cmd-click to select multiple)</span>
          </label>
          <select id="premedAdvanced" multiple size="12">

            <optgroup label="TDK (Cats)">
              <option value="tdk_im">TDK IM 1:1:1:1</option>
              <option value="tdk_iv">TDK IV 1:1:1:1</option>
            </optgroup>

            <optgroup label="Methadone-based">
              <option value="methadone_midaz_im">Methadone + Midazolam IM</option>
              <option value="methadone_midaz_iv">Methadone + Midazolam IV</option>
              <option value="methadone_dex_im">Methadone + Dex IM</option>
              <option value="methadone_dex_iv">Methadone + Dex IV</option>
              <option value="methadone_im">Methadone IM</option>
              <option value="methadone_iv">Methadone IV</option>
            </optgroup>

            <optgroup label="Hydromorphone-based">
              <option value="hydro_midaz_im">Hydromorphone + Midazolam IM</option>
              <option value="hydro_midaz_iv">Hydromorphone + Midazolam IV</option>
              <option value="hydro_dex_im">Hydromorphone + Dex IM</option>
              <option value="hydro_dex_iv">Hydromorphone + Dex IV</option>
              <option value="hydromorphone_im">Hydromorphone IM</option>
              <option value="hydromorphone_iv">Hydromorphone IV</option>
            </optgroup>

            <optgroup label="Butorphanol-based">
              <option value="torb_midaz_im">Torb + Midazolam IM</option>
              <option value="torb_midaz_iv">Torb + Midazolam IV</option>
              <option value="torb_ket_midaz_im">Torb + Ketamine + Midaz IM</option>
              <option value="torb_ket_midaz_iv">Torb + Ketamine + Midaz IV</option>
            </optgroup>

            <optgroup label="Buprenorphine-based">
              <option value="bup_midaz_im">Buprenorphine + Midazolam IM</option>
              <option value="bup_midaz_iv">Buprenorphine + Midazolam IV</option>
              <option value="bup_dex_im">Buprenorphine + Dex IM</option>
              <option value="bup_dex_iv">Buprenorphine + Dex IV</option>
              <option value="bup_im">Buprenorphine IM</option>
              <option value="bup_iv">Buprenorphine IV</option>
              <option value="bup_sr">Buprenorphine SR (IM)</option>
            </optgroup>

          </select>
        </div>
      </div>

      <!-- Induction -->
      <div class="field-row">
        <div class="field">
          <label class="field-label">Induction</label>
          <select id="inductionSelect">
            <option value="">Select...</option>
            <option value="propofol">Propofol</option>
            <option value="alfaxalone">Alfaxalone</option>
            <option value="ket_diaz">Ketamine + Diazepam</option>
            <option value="mask">Mask induction</option>
            <option value="rsi">Rapid sequence induction</option>
          </select>
        </div>
      </div>

      <!-- Intra-op meds -->
      <div class="field-row">
        <div class="field">
          <label class="field-label">Intra-op medications</label>
          <select id="intraOp" multiple size="6">
            <option value="meloxicam_inj">Meloxicam inj</option>
            <option value="onsior_inj">Onsior inj</option>
            <option value="cefazolin">Cefazolin</option>
            <option value="duplicillin">Duplicillin IM</option>
            <option value="local_blocks">Local blocks</option>
          </select>
        </div>
      </div>

      <!-- Post-op -->
      <div class="field-row">
        <div class="field">
          <label class="field-label">Post-op analgesia</label>
          <select id="postOpAnalgesia" multiple size="6">
            <option value="meloxicam_oral">Meloxicam oral</option>
            <option value="onsior_oral">Onsior oral</option>
            <option value="gabapentin">Gabapentin</option>
            <option value="bup_sr">Buprenorphine SR</option>
          </select>
        </div>

        <div class="field">
          <label class="field-label">Post-op antibiotics</label>
          <select id="postOpAntibiotics" multiple size="6">
            <option value="convenia">Convenia</option>
            <option value="amoxi_clav">Amoxi-Clav</option>
          </select>
        </div>
      </div>

      <!-- === SOAP MAIN TEXT AREAS === -->
      <div class="field">
        <label class="field-label">Core notes / history</label>
        <textarea id="soapCoreNotes"></textarea>
      </div>

      <div class="field">
        <label class="field-label">PE & diagnostics (data only)</label>
        <textarea id="soapPE"></textarea>
      </div>

      <div class="field">
        <label class="field-label">Assessment hints</label>
        <textarea id="soapAssessmentHints"></textarea>
      </div>

      <div class="field">
        <label class="field-label">Plan & discharge hints</label>
        <textarea id="soapPlanHints"></textarea>
      </div>

      <div class="field">
        <label class="field-label">Extra instructions</label>
        <textarea id="soapExtra"></textarea>
      </div>

      <!-- External transcript -->
      <div class="collapse-toggle" id="extTranscriptToggle">
        â–¶ External transcript (Covet or call log)
      </div>
      <div class="collapse-body" id="extTranscriptBody" style="display:none;">
        <textarea id="externalTranscript"></textarea>
        <label class="checkbox-inline">
          <input type="checkbox" id="externalTranscriptInclude" />
          <span>Include structured communication summary</span>
        </label>
      </div>

      <!-- Voice recorder: 3-button system -->
      <div class="collapse-toggle" id="voiceToggle">
        â–¶ Voice notes
      </div>

      <div class="collapse-body" id="voiceBody" style="display:none;">
        <div class="recorder-strip">

          <div class="rec-top-row">
            <button class="btn btn-soft" id="voiceRecordBtn">ðŸŽ™ Record</button>
            <div class="rec-status">
              <span id="voiceRecDot" class="rec-dot"></span>
              <span id="voiceRecStatus">Not recording</span>
            </div>
          </div>

          <div class="rec-actions">
            <button class="btn btn-soft" id="voiceSendToBackendBtn">Send to backend</button>
            <button class="btn btn-primary" id="voiceSendToTextboxBtn">Insert into transcript box</button>
            <button class="btn btn-danger" id="voiceClearBtn">Clear</button>
          </div>

          <div class="collapse-toggle" id="voiceTranscriptToggle">
            â–¶ Transcript (editable)
          </div>
          <div class="collapse-body" id="voiceTranscriptBody" style="display:none;">
            <textarea id="voiceTranscriptEdit" class="scroll-area"></textarea>
          </div>
        </div>
      </div>      <!-- ====== TOOLBOX SECTION ====== -->
      <div id="toolboxSection" class="panel" style="display:none;">
        <div class="panel-header">
          <div class="panel-title">Toolbox</div>
          <div class="panel-chip">Bloodwork Â· Client Update Â· Handout Â· Weight Consult Â· Freeform</div>
        </div>

        <div class="panel-body">

          <!-- Vision-enabled file upload -->
          <div class="field-row">
            <button class="btn btn-soft" id="toolboxUploadBtn">ðŸ“· Upload photos / PDFs</button>
            <input type="file" id="toolboxFiles" multiple style="display:none;">
          </div>

          <div id="toolboxFilesPreview" class="tiny">No files uploaded.</div>

          <!-- Toolbox dropdown -->
          <div class="field">
            <label class="field-label">Select tool</label>
            <select id="toolboxMode">
              <option value="bloodwork">Bloodwork Analysis</option>
              <option value="email">Client Update Helper</option>
              <option value="handout">Client Handout Builder</option>
              <option value="snippet">SOAP Snippet Helper</option>
              <option value="weight">Weight Consult / Weight Loss Plan</option>
              <option value="freeform">Freeform (Use all context)</option>
            </select>
          </div>

          <!-- Toolbox input -->
          <div class="field">
            <label class="field-label">Core text for the tool</label>
            <textarea id="toolboxInput" placeholder="Paste values, client concerns, or instructions."></textarea>
          </div>

          <!-- External transcript -->
          <div class="collapse-toggle" id="toolboxExtToggle">â–¶ External transcript</div>
          <div class="collapse-body" id="toolboxExtBody" style="display:none;">
            <textarea id="toolboxExtTranscript" class="scroll-area"
              placeholder="Paste long client call, Covet transcript, or external note."></textarea>
          </div>

          <!-- Recorder -->
          <div class="collapse-toggle" id="toolboxVoiceToggle">â–¶ Voice notes</div>
          <div class="collapse-body" id="toolboxVoiceBody" style="display:none;">
            <div class="recorder-strip">

              <div class="rec-top-row">
                <button class="btn btn-soft" id="toolboxRecordBtn">ðŸŽ™ Record</button>
                <div class="rec-status">
                  <span id="toolboxRecDot" class="rec-dot"></span>
                  <span id="toolboxRecStatus">Not recording</span>
                </div>
              </div>

              <div class="rec-actions">
                <button class="btn btn-soft" id="toolboxSendBackendBtn">Send to backend</button>
                <button class="btn btn-primary" id="toolboxSendTextboxBtn">Insert into transcript box</button>
                <button class="btn btn-danger" id="toolboxRecClearBtn">Clear</button>
              </div>

              <div class="collapse-toggle" id="toolboxTranscriptToggle">â–¶ Transcript</div>
              <div class="collapse-body" id="toolboxTranscriptBody" style="display:none;">
                <textarea id="toolboxTranscriptEdit" class="scroll-area"></textarea>
              </div>
            </div>
          </div>

          <div class="button-row">
            <button class="btn btn-primary" id="toolboxGenerateBtn">Generate</button>
          </div>

        </div>
      </div>

      <!-- ====== CONSULT SECTION ====== -->
      <div id="consultSection" class="panel" style="display:none;">
        <div class="panel-header">
          <div class="panel-title">Consult</div>
          <div class="panel-chip">Differentials Â· Plans Â· Reasoning</div>
        </div>

        <div class="panel-body">

          <!-- Vision-enabled file upload -->
          <div class="field-row">
            <button class="btn btn-soft" id="consultUploadBtn">ðŸ“· Upload photos / PDFs</button>
            <input type="file" id="consultFiles" multiple style="display:none;">
          </div>

          <div id="consultFilesPreview" class="tiny">No files uploaded.</div>

          <div class="field">
            <label class="field-label">Consult question</label>
            <textarea id="consultQuestion" placeholder="What do you want help with?"></textarea>
          </div>

          <div class="field">
            <label class="field-label">Case context</label>
            <textarea id="consultContext" placeholder="Signalment, history, findings, labs, imaging..."></textarea>
          </div>

          <!-- External transcript -->
          <div class="collapse-toggle" id="consultExtToggle">â–¶ External transcript</div>
          <div class="collapse-body" id="consultExtBody" style="display:none;">
            <textarea id="consultExtTranscript" class="scroll-area"
              placeholder="Call logs, long dictations, or Covet transcription."></textarea>
          </div>

          <!-- Recorder -->
          <div class="collapse-toggle" id="consultVoiceToggle">â–¶ Voice notes</div>
          <div class="collapse-body" id="consultVoiceBody" style="display:none;">
            <div class="recorder-strip">

              <div class="rec-top-row">
                <button class="btn btn-soft" id="consultRecordBtn">ðŸŽ™ Record</button>
                <div class="rec-status">
                  <span id="consultRecDot" class="rec-dot"></span>
                  <span id="consultRecStatus">Not recording</span>
                </div>
              </div>

              <div class="rec-actions">
                <button class="btn btn-soft" id="consultSendBackendBtn">Send to backend</button>
                <button class="btn btn-primary" id="consultSendTextboxBtn">Insert into transcript box</button>
                <button class="btn btn-danger" id="consultRecClearBtn">Clear</button>
              </div>

              <div class="collapse-toggle" id="consultTranscriptToggle">â–¶ Transcript</div>
              <div class="collapse-body" id="consultTranscriptBody" style="display:none;">
                <textarea id="consultTranscriptEdit" class="scroll-area"></textarea>
              </div>
            </div>
          </div>

          <div class="button-row">
            <button class="btn btn-primary" id="consultGenerateBtn">Generate</button>
          </div>
        </div>
      </div>

      <!-- ===== OUTPUT PANEL (RIGHT SIDE) ===== -->
      <div id="outputPanel" class="panel">
        <div class="panel-header">
          <div class="panel-title">AI Output</div>
          <div class="panel-chip">SOAP Â· Toolbox Â· Consult</div>
        </div>

        <div class="panel-body">

          <div class="output-main" id="mainOutput">
            Output will appear here.
          </div>

          <div class="button-row">
            <button class="btn btn-primary" id="copyOutputBtn">Copy</button>

            <!-- MOBILE: send to desktop -->
            <button class="btn btn-soft mobile-only" id="sendToDesktopBtn">ðŸ“¤ Send to desktop</button>
          </div>

          <!-- FEEDBACK BAR -->
          <div class="field">
            <label class="field-label">Feedback</label>
            <textarea id="outputFeedback" placeholder="Refine, reword, expand, fix something..."></textarea>
          </div>

          <div class="button-row">
            <button class="btn btn-soft" id="applyFeedbackBtn">Apply feedback</button>
          </div>

          <!-- Desktop relay -->
          <div class="right-bottom-card desktop-only">
            <div class="right-bottom-row">
              <div class="status-left">
                <div class="status-dot" id="backendStatusDot"></div>
                <span id="backendStatusText">Backend unreachable</span>
              </div>
              <span class="tiny">Phone â†” Desktop relay</span>
            </div>

            <div class="right-bottom-buttons">
              <button class="btn btn-soft" id="receiveFromPhoneBtn">ðŸ“² Receive text/files</button>
            </div>
          </div>

        </div>
      </div>

    </div> <!-- end content-grid -->
  </div> <!-- end app-main -->
</div> <!-- end app-shell -->

<script src="app.js"></script>
</body>
</html>